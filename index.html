<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Erik Adelbert ea@wuage.org" />
  <meta name="author" content="Hugues Morisset huguesm@wuage.org" />
  <title>Bashkit</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    div.abstract {
      margin: 2em 2em 2em 2em;
      text-align: left;
      font-size: 85%;
    }
    div.abstract-title {
      font-weight: bold;
      text-align: center;
      padding: 0;
      margin-bottom: 0.5em;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /*
     * Custom CSS file. Override it as you like.
     *
     * Credits to @killercup (https://gist.github.com/killercup); Extracted from this Gist:
     *   https://gist.github.com/killercup/5917178
     */

    html {
        font-size: 100%;
        overflow-y: scroll;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
    }

    body {
        color: #444;
        font-family: Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman', serif;
        font-size: 12px;
        line-height: 1.7;
        padding: 1em;
        margin: auto;
        max-width: 42em;
        background: #fefefe;
    }

    a {
        color: #0645ad;
        text-decoration: none;
    }

    a:visited {
        color: #0b0080;
    }

    a:hover {
        color: #06e;
    }

    a:active {
        color: #faa700;
    }

    a:focus {
        outline: thin dotted;
    }

    *::-moz-selection {
        background: rgba(255, 255, 0, 0.3);
        color: #000;
    }

    *::selection {
        background: rgba(255, 255, 0, 0.3);
        color: #000;
    }

    a::-moz-selection {
        background: rgba(255, 255, 0, 0.3);
        color: #0645ad;
    }

    a::selection {
        background: rgba(255, 255, 0, 0.3);
        color: #0645ad;
    }

    p {
        margin: 1em 0;
    }

    img {
        max-width: 100%;
    }

    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
        color: #111;
        line-height: 125%;
        margin-top: 2em;
        font-weight: normal;
    }

    h4,
    h5,
    h6 {
        font-weight: bold;
    }

    h1 {
        font-size: 2.5em;
    }

    h2 {
        font-size: 2em;
    }

    h3 {
        font-size: 1.5em;
    }

    h4 {
        font-size: 1.2em;
    }

    h5 {
        font-size: 1em;
    }

    h6 {
        font-size: 0.9em;
    }

    blockquote {
        color: #666666;
        margin: 0;
        padding-left: 3em;
        border-left: 0.5em #EEE solid;
    }

    hr {
        display: block;
        height: 2px;
        border: 0;
        border-top: 1px solid #aaa;
        border-bottom: 1px solid #eee;
        margin: 1em 0;
        padding: 0;
    }

    pre,
    code,
    kbd,
    samp {
        color: #000;
        font-family: monospace, monospace;
        _font-family: 'courier new', monospace;
        font-size: 0.98em;
    }

    pre {
        white-space: pre;
        white-space: pre-wrap;
        word-wrap: break-word;
    }

    b,
    strong {
        font-weight: bold;
    }

    dfn {
        font-style: italic;
    }

    ins {
        background: #ff9;
        color: #000;
        text-decoration: none;
    }

    mark {
        background: #ff0;
        color: #000;
        font-style: italic;
        font-weight: bold;
    }

    sub,
    sup {
        font-size: 75%;
        line-height: 0;
        position: relative;
        vertical-align: baseline;
    }

    sup {
        top: -0.5em;
    }

    sub {
        bottom: -0.25em;
    }

    ul,
    ol {
        margin: 1em 0;
        padding: 0 0 0 2em;
    }

    li p:last-child {
        margin-bottom: 0;
    }

    ul ul,
    ol ol {
        margin: .3em 0;
    }

    dl {
        margin-bottom: 1em;
    }

    dt {
        font-weight: bold;
        margin-bottom: .8em;
    }

    dd {
        margin: 0 0 .8em 2em;
    }

    dd:last-child {
        margin-bottom: 0;
    }

    img {
        border: 0;
        -ms-interpolation-mode: bicubic;
        vertical-align: middle;
    }

    figure {
        display: block;
        text-align: center;
        margin: 1em 0;
    }

    figure img {
        border: none;
        margin: 0 auto;
    }

    figcaption {
        font-size: 0.8em;
        font-style: italic;
        margin: 0 0 .8em;
    }

    table {
        margin-bottom: 2em;
        border-bottom: 1px solid #ddd;
        border-right: 1px solid #ddd;
        border-spacing: 0;
        border-collapse: collapse;
    }

    table th {
        padding: .2em 1em;
        background-color: #eee;
        border-top: 1px solid #ddd;
        border-left: 1px solid #ddd;
    }

    table td {
        padding: .2em 1em;
        border-top: 1px solid #ddd;
        border-left: 1px solid #ddd;
        vertical-align: top;
    }

    .author {
        font-size: 1.2em;
        text-align: center;
    }

    @media only screen and (min-width: 480px) {
        body {
            font-size: 14px;
        }
    }

    @media only screen and (min-width: 768px) {
        body {
            font-size: 16px;
        }
    }

    @media print {
        * {
            background: transparent !important;
            color: black !important;
            filter: none !important;
            -ms-filter: none !important;
        }
        body {
            font-size: 12pt;
            max-width: 100%;
        }
        a,
        a:visited {
            text-decoration: underline;
        }
        hr {
            height: 1px;
            border: 0;
            border-bottom: 1px solid black;
        }
        a[href]:after {
            content: " (" attr(href) ")";
        }
        abbr[title]:after {
            content: " (" attr(title) ")";
        }
        .ir a:after,
        a[href^="javascript:"]:after,
        a[href^="#"]:after {
            content: "";
        }
        pre,
        blockquote {
            border: 1px solid #999;
            padding-right: 1em;
            page-break-inside: avoid;
        }
        tr,
        img {
            page-break-inside: avoid;
        }
        img {
            max-width: 100% !important;
        }
        @page :left {
            margin: 15mm 20mm 15mm 10mm;
        }
        @page :right {
            margin: 15mm 10mm 15mm 20mm;
        }
        p,
        h2,
        h3 {
            orphans: 3;
            widows: 3;
        }
        h2,
        h3 {
            page-break-after: avoid;
        }
    }  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Bashkit</h1>
<p class="author">Erik Adelbert <a href="mailto:ea@wuage.org"
class="email">ea@wuage.org</a></p>
<p class="author">Hugues Morisset <a href="mailto:huguesm@wuage.org"
class="email">huguesm@wuage.org</a></p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#what-is-bashkit" id="toc-what-is-bashkit">What is
bashkit</a></li>
<li><a href="#download" id="toc-download">Download</a></li>
<li><a href="#documentation"
id="toc-documentation">Documentation</a></li>
<li><a href="#mailing-lists" id="toc-mailing-lists">Mailing
Lists</a></li>
<li><a href="#getting-involved" id="toc-getting-involved">Getting
involved</a>
<ul>
<li><a href="#development" id="toc-development">Development</a></li>
<li><a href="#translating-bashkit"
id="toc-translating-bashkit">Translating Bashkit</a></li>
<li><a href="#maintainer" id="toc-maintainer">Maintainer</a></li>
</ul></li>
<li><a href="#definitions" id="toc-definitions">Definitions</a></li>
<li><a href="#table-of-contents" id="toc-table-of-contents">Table of
Contents</a></li>
<li><a href="#basic-bashkit-features"
id="toc-basic-bashkit-features">Basic Bashkit features</a>
<ul>
<li><a href="#logging" id="toc-logging">Logging</a></li>
<li><a href="#error-handling" id="toc-error-handling">Error
handling</a></li>
<li><a href="#bashkit-scripting" id="toc-bashkit-scripting">Bashkit
scripting</a></li>
</ul></li>
<li><a href="#bashkitload" id="toc-bashkitload">bashkit::load</a></li>
<li><a href="#catch" id="toc-catch">catch</a></li>
<li><a href="#not" id="toc-not">not</a></li>
<li><a href="#raise" id="toc-raise">raise</a></li>
<li><a href="#resume" id="toc-resume">resume</a></li>
<li><a href="#colorencode" id="toc-colorencode">color::encode</a></li>
<li><a href="#coloris_enabled"
id="toc-coloris_enabled">color::is_enabled</a></li>
<li><a href="#colortable" id="toc-colortable">color::table</a></li>
<li><a href="#breakpoint" id="toc-breakpoint">breakpoint</a></li>
<li><a href="#errcodetrap" id="toc-errcodetrap">errcode::trap</a></li>
<li><a href="#errorclass" id="toc-errorclass">error::class</a></li>
<li><a href="#errorcustom" id="toc-errorcustom">error::custom</a></li>
<li><a href="#errorlist" id="toc-errorlist">error::list</a></li>
<li><a href="#errorwhatis" id="toc-errorwhatis">error::whatis</a></li>
<li><a href="#alert" id="toc-alert">alert</a></li>
<li><a href="#crit" id="toc-crit">crit</a></li>
<li><a href="#debug" id="toc-debug">debug</a></li>
<li><a href="#error" id="toc-error">error</a></li>
<li><a href="#fatal" id="toc-fatal">fatal</a></li>
<li><a href="#info" id="toc-info">info</a></li>
<li><a href="#logginglevel"
id="toc-logginglevel">logging::level</a></li>
<li><a href="#note" id="toc-note">note</a></li>
<li><a href="#panic" id="toc-panic">panic</a></li>
<li><a href="#loggingsetlevel"
id="toc-loggingsetlevel">logging::setlevel</a></li>
<li><a href="#warn" id="toc-warn">warn</a></li>
<li><a href="#trapcallback"
id="toc-trapcallback">trap::callback</a></li>
<li><a href="#cleanup" id="toc-cleanup">cleanup</a></li>
<li><a href="#arraycontains"
id="toc-arraycontains">array::contains</a></li>
<li><a href="#arrayinter" id="toc-arrayinter">array::inter</a></li>
<li><a href="#arraymap" id="toc-arraymap">array::map</a></li>
<li><a href="#arraypick" id="toc-arraypick">array::pick</a></li>
<li><a href="#arraypop" id="toc-arraypop">array::pop</a></li>
<li><a href="#arraypopi" id="toc-arraypopi">array::popi</a></li>
<li><a href="#arraypush" id="toc-arraypush">array::push</a></li>
<li><a href="#arrayreduce" id="toc-arrayreduce">array::reduce</a></li>
<li><a href="#arrayreverse"
id="toc-arrayreverse">array::reverse</a></li>
<li><a href="#arrayrotate" id="toc-arrayrotate">array::rotate</a></li>
<li><a href="#arrayshift" id="toc-arrayshift">array::shift</a></li>
<li><a href="#arrayshuffle"
id="toc-arrayshuffle">array::shuffle</a></li>
<li><a href="#arraysort" id="toc-arraysort">array::sort</a></li>
<li><a href="#arraysplit" id="toc-arraysplit">array::split</a></li>
<li><a href="#arrayuniq" id="toc-arrayuniq">array::uniq</a></li>
<li><a href="#arrayunshift"
id="toc-arrayunshift">array::unshift</a></li>
<li><a href="#arrayzip" id="toc-arrayzip">array::zip</a></li>
<li><a href="#checkcmd" id="toc-checkcmd">check::cmd</a></li>
<li><a href="#checkdir" id="toc-checkdir">check::dir</a></li>
<li><a href="#checkvartype"
id="toc-checkvartype">check::vartype</a></li>
<li><a href="#curldownload"
id="toc-curldownload">curl::download</a></li>
<li><a href="#funlist" id="toc-funlist">funlist</a></li>
<li><a href="#isint" id="toc-isint">isint</a></li>
<li><a href="#join" id="toc-join">join</a></li>
<li><a href="#now" id="toc-now">now</a></li>
<li><a href="#progress" id="toc-progress">progress</a></li>
<li><a href="#urldecode" id="toc-urldecode">urldecode</a></li>
<li><a href="#urlencode" id="toc-urlencode">urlencode</a></li>
<li><a href="#usleep" id="toc-usleep">usleep</a></li>
<li><a href="#interactiveyesno"
id="toc-interactiveyesno">interactive::yesno</a></li>
<li><a href="#jsonfrom_toml"
id="toc-jsonfrom_toml">json::from_toml</a></li>
<li><a href="#jsonfrom_yaml"
id="toc-jsonfrom_yaml">json::from_yaml</a></li>
<li><a href="#jsoninto_array"
id="toc-jsoninto_array">json::into_array</a></li>
<li><a href="#jsoninto_dict"
id="toc-jsoninto_dict">json::into_dict</a></li>
<li><a href="#jsonto_toml" id="toc-jsonto_toml">json::to_toml</a></li>
<li><a href="#jsonto_yaml" id="toc-jsonto_yaml">json::to_yaml</a></li>
<li><a href="#patchapply" id="toc-patchapply">patch::apply</a></li>
<li><a href="#patchbatch" id="toc-patchbatch">patch::batch</a></li>
<li><a href="#permsgid" id="toc-permsgid">perms::gid</a></li>
<li><a href="#permsmode" id="toc-permsmode">perms::mode</a></li>
<li><a href="#permsuid" id="toc-permsuid">perms::uid</a></li>
<li><a href="#readlinkf" id="toc-readlinkf">readlinkf</a></li>
<li><a href="#shoptpop" id="toc-shoptpop">shopt::pop</a></li>
<li><a href="#shoptpush" id="toc-shoptpush">shopt::push</a></li>
<li><a href="#stringlstrip"
id="toc-stringlstrip">string::lstrip</a></li>
<li><a href="#stringregex" id="toc-stringregex">string::regex</a></li>
<li><a href="#stringrstrip"
id="toc-stringrstrip">string::rstrip</a></li>
<li><a href="#stringsplit" id="toc-stringsplit">string::split</a></li>
<li><a href="#stringstrip" id="toc-stringstrip">string::strip</a></li>
<li><a href="#stringstripall"
id="toc-stringstripall">string::stripall</a></li>
<li><a href="#stringtrim" id="toc-stringtrim">string::trim</a></li>
</ul>
</nav>
<h1 id="what-is-bashkit">What is bashkit</h1>
<p>Bashkit is an opiniated scripting model and framework for <a
href="https://www.gnu.org/software/bash/">Bash 5.x</a>. It is intended
to help writing more robust scripts in which unhandled errors are
preferably fatal. It does so by enforcing and exploiting selected
<em>bashisms</em> and sometimes moving away from IEEE POSIX P1003.2/ISO
9945.2. It supplements bash as a collection of modules akin to a
<em>script development library</em>. It consists mostly in pure bash
functions with very few dependencies.</p>
<p>Bashkit is a scripting model that proposes idioms and tools for:</p>
<ul>
<li>fail fast scripting</li>
<li>avoiding some bash scripting pitfalls</li>
<li>runtime error handling and event logging</li>
</ul>
<p>Bashkit comes with 7 <em>core</em> and 11 <em>standard</em> function
modules. A bashkit script is a bash script that, at some point
<em>sources</em> bashkit and modules and starts calling their functions.
<em>Custom modules</em> are easy to write and module boilerplates are
kept small. Nonetheless, a proper error handling surely requires
editing.</p>
<p>Core modules implement:</p>
<ul>
<li><em>revised control flows</em></li>
<li><em>ANSI color for the masses</em></li>
<li><em>error code handling</em></li>
<li><em>exhaustive error scheme</em></li>
<li><em>advanced logging routines</em></li>
<li><em>thorough signal trap handling</em></li>
<li><em>stateful bashkit versionning</em></li>
</ul>
<p>Standard modules bring:</p>
<ul>
<li><em>easy array manipulations</em></li>
<li><em>advanced checking, including variable type checking</em></li>
<li><em>curl download integration</em></li>
<li><em>yes/no interaction support</em></li>
<li><em>json conversions</em></li>
<li><em>patch integration</em></li>
<li><em>file permissions conversion</em></li>
<li><em>readlink as a function</em></li>
<li><em>shopt stacking</em></li>
<li><em>semver comparison</em></li>
<li><em>string manipulations</em></li>
</ul>
<blockquote>
<p>A module can be loaded either when sourcing <code>Bashkit</code> or
by calling <code>bashkit::load(1)</code></p>
</blockquote>
<div class="sourceCode" id="cb1"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a>  <span class="bu">source</span> bashkit.bash check shopt <span class="co"># load bashkit along with check and shopt modules</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="ex">bashkit::load</span> array <span class="co"># load array module</span></span></code></pre></div>
<h1 id="download">Download</h1>
<p>Stable releases can be found at <a
href="https://github.com/Wuageorg/bashkit">wuage</a>.</p>
<h1 id="documentation">Documentation</h1>
<p>Documentation for Bashkit is available <a
href="http://bashkit.wuage.io">online</a>. You may also find information
on Bashkit by running TODO.</p>
<h1 id="mailing-lists">Mailing Lists</h1>
<p>TODO</p>
<h1 id="getting-involved">Getting involved</h1>
<p>TODO</p>
<h2 id="development">Development</h2>
<p>TODO</p>
<h2 id="translating-bashkit">Translating Bashkit</h2>
<p>TODO</p>
<h2 id="maintainer">Maintainer</h2>
<p>TODO</p>
<h1 id="definitions">Definitions</h1>
<p>These definitions are used throughout the remainder of this
manual.</p>
<p><strong>POSIX</strong><br />
A family of open system standards based on Unix. Bash and Bashkit are
primarily concerned with the Shell<br />
and Utilities portion of the POSIX 1003.1 standard.</p>
<p><strong>blank</strong><br />
A space or a tab character.</p>
<p><strong>builtin</strong><br />
A command that is implemented internally by the shell itself, rather
than by an executable program<br />
somewhere in the file system.</p>
<p><strong>control operator</strong><br />
A token that performs a control function. It is a newline or one of the
following:<br />
‘||’, ‘&amp;&amp;’, ‘&amp;’, ‘;’, ‘;;’, ‘;&amp;’, ‘;;&amp;’, ‘|’,
‘|&amp;’, ‘(’, or ‘)’.</p>
<p><strong>exit status or error code or errcode</strong><br />
The value returned by a command to its caller. The value is restricted
to eight bits,<br />
so the maximum value is 255.</p>
<p><strong>field</strong><br />
A unit of text that is the result of one of the shell expansions. After
expansion, when<br />
executing a command, the resulting fields are used as the command name
and arguments.</p>
<p><strong>filename</strong><br />
A string of characters used to identify a file.</p>
<p><strong>job</strong><br />
A set of processes comprising a pipeline, and any processes descended
from it, that are<br />
all in the same process group.</p>
<p><strong>job control</strong><br />
A mechanism by which users can selectively stop (suspend) and restart
(resume) execution<br />
of processes.</p>
<p><strong>metacharacter</strong><br />
A character that, when unquoted, separates words. A metacharacter is a
space, tab, newline,<br />
or one of the following characters: ‘|’, ‘&amp;’, ‘;’, ‘(’, ‘)’, ‘&lt;’,
or ‘&gt;’.</p>
<p><strong>name</strong><br />
A word consisting solely of letters, numbers, and underscores, and
beginning with a letter<br />
or underscore. Names are used as shell variable and function names. Also
referred to as an<br />
identifier.</p>
<p><strong>operator</strong><br />
A control operator or a redirection operator. See Redirections, for a
list of redirection<br />
operators. Operators contain at least one unquoted metacharacter.</p>
<p><strong>process group</strong><br />
A collection of related processes each having the same process group
ID.</p>
<p><strong>process group ID</strong><br />
A unique identifier that represents a process group during its
lifetime.</p>
<p><strong>reserved word</strong><br />
A word that has a special meaning to the shell. Most reserved words
introduce shell flow<br />
control constructs, such as for and while.</p>
<p><strong>return status</strong><br />
A synonym for exit status.</p>
<p><strong>signal</strong><br />
A mechanism by which a process may be notified by the kernel of an event
occurring in<br />
the system.</p>
<p><strong>special builtin</strong><br />
A shell builtin command that has been classified as special by the POSIX
standard.</p>
<p><strong>token</strong><br />
A sequence of characters considered a single unit by the shell. It is
either a word or<br />
an operator.</p>
<p><strong>word</strong><br />
A sequence of characters treated as a unit by the shell. Words may not
include unquoted<br />
metacharacters.</p>
<h1 id="table-of-contents">Table of Contents</h1>
<ol type="1">
<li><a href="#logging">Logging</a>
<ol type="1">
<li><a href="#standard-logging">Standard logging</a></li>
<li><a href="#json-logging">JSON logging</a></li>
<li><a href="#panicking">Panicking</a></li>
<li><a href="#report-and-trace">Report and Trace</a></li>
</ol></li>
<li><a href="#error-handling">Error Handling</a>
<ol type="1">
<li><a href="#discussion">Discussion</a></li>
<li><a href="#error-code-mapping">Error code mapping</a></li>
<li><a href="#flow-of-control-with-true">Flow of control with
true</a></li>
<li><a href="#raise-catch-and-resume">raise, catch and resume</a></li>
</ol></li>
<li><a href="#bashkit-scripting">Bashkit scripting</a>
<ol type="1">
<li><a href="#unhandled-errors">Unhandled errors</a></li>
<li><a href="#fail-fast">Fail fast</a></li>
<li><a href="#traps-and-cleanup">Traps and cleanup</a></li>
<li><a href="#colors">Colors</a></li>
</ol></li>
</ol>
<h1 id="basic-bashkit-features">Basic Bashkit features</h1>
<p>Bashkit is an acronym for <code>Bourne-Again SHell KIT</code>. It
supplements Bash and can not be used without. This chapter briefly
summarizes the bashkit’s <em>building blocks</em>: logging, control
structures, functions, and how the shell executes commands with active
bashkit.</p>
<h2 id="logging">Logging</h2>
<p>Bashkit as a proper software framework offers a logging system. A
bashkit script can and should record software events in a structured
way. Bashkit follows <code>syslog(1)</code> levels to implement
<em>logging routines</em>:</p>
<table>
<colgroup>
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="header">
<th>routine</th>
<th style="text-align: center;">panic</th>
<th style="text-align: center;">alert</th>
<th style="text-align: center;">crit</th>
<th style="text-align: center;">error</th>
<th style="text-align: center;">warn</th>
<th style="text-align: center;">note</th>
<th style="text-align: center;">info</th>
<th style="text-align: center;">debug</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>level</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">7</td>
</tr>
</tbody>
</table>
<p>Logging level is controlled either by setting the global variable
<code>$LOGLEVEL</code> beforehand or by calling
<code>logging:setlevel</code> at runtime. Default logging level is
<code>INFO/6</code>. As expected, a logging routine displays a message
when the current logging level is <em>lower or equal</em> to its own,
otherwise the message is silenced but planned side-effects occur (see
<code>errcode</code>).</p>
<blockquote>
<p>there’s a bashkit routine named <code>info</code>. It shadows
<code>info(1)</code> the bash info document reader. If you need to use
<code>info(1)</code>, call it with <code>command</code>
<code>info</code> <code>[args]</code>.</p>
</blockquote>
<h4 id="example">Example:</h4>
<div class="sourceCode" id="cb2"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a><span class="ex">bash-5.2$</span> cat hello.bash</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="bu">source</span> <span class="va">${SOME_PATH_TO_BASHKIT}</span>/bashkit.bash</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="ex">info</span> <span class="st">&#39;hello world!&#39;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="ex">bash-5.2$</span> bash <span class="at">-c</span> ./hello.bash</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="ex">2022-10-12</span> 18:27:33+0200 [ info] ./hello.bash:3<span class="kw">|</span> <span class="ex">hello</span> world!</span></code></pre></div>
<h3 id="standard-logging">Standard logging</h3>
<p>Standard logging happens on <code>stderr</code>, when on a supported
terminal it is colorized by default. Whenever color is unsuitable, it
can be disabled by setting the global variable <code>$NO_COLOR</code>.
As shown in <code>hello.bash</code> example, standard logging routines
display a default format:</p>
<pre><code>YYYY-MM-DD HH:MM:SS+hhmm [LEVEL] ORIGIN:LINENO| MSG</code></pre>
<table>
<colgroup>
<col style="width: 11%" />
<col style="width: 88%" />
</colgroup>
<thead>
<tr class="header">
<th>field</th>
<th>format</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>STAMP</td>
<td>ISO-8601 extended offset date-time format</td>
</tr>
<tr class="even">
<td>LEVEL</td>
<td>routine name in a padded string of length 5, enclosed in
brackets</td>
</tr>
<tr class="odd">
<td>ORIGIN</td>
<td>$FUNCNAME or $FILENAME or main or bash</td>
</tr>
<tr class="even">
<td>LINENO</td>
<td>integer of calling time $LINENO value</td>
</tr>
<tr class="odd">
<td>MSG</td>
<td>arbitrary bash expandable string after “|”</td>
</tr>
</tbody>
</table>
<h3 id="json-logging">JSON logging</h3>
<p>JSON logging happens on <code>stderr</code>, it is enabled by setting
the global variable <code>$JSON</code> beforehand. When activated, it
replaces standard logging output. Messages are emitted in <a
href="http://ndjson.org">NDJSON</a> format and consist in valid json
values with no color and a fix layout:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a><span class="st">&#39;{ &quot;date&quot;: &quot;STAMP&quot;, &quot;level&quot;: &quot;LEVEL&quot;, &quot;func&quot;: &quot;ORIGIN&quot;, &quot;lineno&quot;: &quot;LINENO&quot;, &quot;text&quot;: &quot;MSG&quot; }\n&#39;</span></span></code></pre></div>
<p>Fields STAMP, LEVEL, …, MSG are similar to standard logging except
for LEVEL that is not padded nor bracketed. They are all enclosed in
double-quotes.</p>
<h4 id="example-1">Example:</h4>
<div class="sourceCode" id="cb5"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">bash-5.2$</span> bash <span class="at">-c</span> <span class="st">&#39;JSON=1 ./hello.bash&#39;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="kw">{</span> <span class="st">&quot;date&quot;</span><span class="ex">:</span> <span class="st">&quot;2022-10-13 17:35:04+0200&quot;</span>, <span class="st">&quot;level&quot;</span>: <span class="st">&quot;info&quot;</span>, <span class="st">&quot;func&quot;</span>: <span class="st">&quot;./hello.bash&quot;</span>, <span class="st">&quot;lineno&quot;</span>: <span class="st">&quot;3&quot;</span>, <span class="st">&quot;text&quot;</span>: <span class="st">&quot;hello world!&quot;</span> }</span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="ex">bash-5.2$</span></span></code></pre></div>
<h3 id="panicking">Panicking</h3>
<p><code>panic</code> and <code>fatal</code> are special logging
routines that stop the ordinary flow of control and begin
<em>panicking</em>:</p>
<ul>
<li><code>panic</code> calls bash <code>exit</code> with code 1</li>
<li><code>fatal</code> calls bash <code>exit</code> with a previously
set value (see <code>errcode</code>)</li>
<li>registered <code>cleanup</code> functions (see <code>trap</code>)
execute normally in LIFO order until the last one</li>
<li>at that point, the script crashes</li>
</ul>
<p>Panics can only be initiated by invoking <code>panic</code> or
<code>fatal</code> directly.</p>
<h3 id="report-and-trace">Report and Trace</h3>
<p>Report mode is controlled by setting the global variable
<code>$REPORT</code>. When activated, the script will dump a stack-trace
and exit whenever an error is detected by bashkit.</p>
<p>Trace mode is controlled by <code>$TRACE</code>. When activated:</p>
<ul>
<li>bash is put in <code>xtrace</code> mode</li>
<li>additional program counter details are displayed by
<code>$PS4</code></li>
<li><code>report</code> mode is activated</li>
<li>logging level is set to <code>DEBUG/7</code></li>
</ul>
<h2 id="error-handling">Error handling</h2>
<p>Bashkit proposes a unique yet classical error handling coding
patterns. They extend bash error semantic by exploiting conditional
statements. They assemble into error handling pipelines. Bashkit uses a
trap to catch errors as they arise. If they are handled locally, the
flow of control proceeds. Otherwise, the error is bubbled up the calling
stack until handled. When an unhandled error reaches its calling-stack
root, the calling script usually crashes. In Bashkit, almost <em>all
errors are fatal</em>.</p>
<h3 id="discussion">Discussion</h3>
<p>Handling error in bash is difficult: The query “error handling in
bash”, on the biggest search engine, returns +88M links as of October
2022. On <a
href="https://stackoverflow.com/questions/64786/error-handling-in-bash">SO</a>,
a closely related question, asked in 2008, was viewed +410k times and
received answers as late as early 2022. Eventually, it was deemed
“opinion-based” by moderators and closed to more answers.</p>
<p>Bash basic exit status handling is flawed by decisions made early
during bash design along with heavy POSIX constraints on the subject.
The resulting <code>set -e</code> mode is unsatisfactory and
error-prone: whenever scripts are thought to fail fast, they could just
behave in unintuitive ways, fallen into one of the many bash
pitfalls.</p>
<p>Bashkit helps scripts to efficiently handle errors or fail fast in
most of the cases. One should be aware that some bash quirks are simply
unreachable to address within bash itself. Don’t do this:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">diff</span> <span class="op">&lt;(</span><span class="fu">sort</span> A<span class="op">)</span> <span class="op">&lt;(</span><span class="fu">sort</span> B<span class="op">)</span></span></code></pre></div>
<h3 id="error-code-mapping">Error code mapping</h3>
<p>Bashkit defines an error code mapping that closely follows <a
href="https://www.gnu.org/software/bash/manual/html_node/Exit-Status.html">bash
definition</a> and adds additional constraints to it:</p>
<ul>
<li>an error is a global variable with a name prefixed by “E_” followed
by words connected with “_” ex. <code>$E_FAILURE</code> but not
<del>$E_FAILURE_</del></li>
<li>such a variable contains a <em>uniquely</em> assigned integer, a
preset ex. <code>E_FAILURE=1</code></li>
<li>bashkit owns some of the preset errors</li>
<li>bash is said to own some other preset errors</li>
<li>signal is a shorcut to bash/[129-192]</li>
<li>ownership is conventional and not enforced in any way</li>
<li>the proposed mapping is declared at runtime</li>
<li><em>custom</em> errors can be registered at runtime</li>
</ul>
<table>
<colgroup>
<col style="width: 12%" />
<col style="width: 37%" />
<col style="width: 6%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="header">
<th>range</th>
<th>names</th>
<th>owner</th>
<th>note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-3</td>
<td>E_SUCCESS - E_UNSUPPORTED</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>4-7</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="odd">
<td>8-32</td>
<td>E_BASHKIT - E_CUSTOM</td>
<td>bashkit</td>
<td>highest bit is 3 or 4</td>
</tr>
<tr class="even">
<td>33-123</td>
<td>custom names</td>
<td>user</td>
<td>highest bit is 5 or 6 but err &lt; 124</td>
</tr>
<tr class="odd">
<td>124-128</td>
<td>E_TIMEOUT - E_INVALID_EXIT</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>129-192</td>
<td>E_SIGHUP - E_SIGRTMAX</td>
<td>signal</td>
<td>highest bit is 7 low bits for signum</td>
</tr>
<tr class="odd">
<td>193-254</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="even">
<td>255</td>
<td>E_OUT_OF_RANGE</td>
<td>bash</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>bashkit offers tools to manipulate errors (see
<code>error</code>)</p>
</blockquote>
<h3 id="flow-of-control-with-true">Flow of control with true</h3>
<p>Using <code>true</code> as a control flow mechanism is already a bash
idiom:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">#!/usr/bin/env bash</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="ex">up_the_game</span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">rm</span> some_random_file_that_could_not_exist <span class="kw">||</span> <span class="fu">true</span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="bu">echo</span> <span class="st">&quot;all went well!&quot;</span></span></code></pre></div>
<p>Under <code>errcode</code>, the bashkit error handling system, you
can do the same:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="ex">up_the_game</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">rm</span> some_random_file_that_could_not_exist <span class="kw">||</span> <span class="fu">true</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="bu">echo</span> <span class="st">&quot;all went well!&quot;</span></span></code></pre></div>
<p><code>true</code>, is the most basic <code>errcode handler</code> of
all. Using <code>true</code> to handle an error means this error is
irrelevant to the flow of control.</p>
<blockquote>
<p><code>return</code> and <code>exit</code> are also
<code>errcode</code> compatible so existing constructs are
preserved.</p>
</blockquote>
<h3 id="raise-catch-and-resume">raise, catch and resume</h3>
<div class="sourceCode" id="cb9"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">check_cmd()</span> <span class="kw">{</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="bu">command</span> <span class="at">-v</span> <span class="st">&quot;</span><span class="va">${cmd}</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span> /dev/null</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="kw">}</span></span></code></pre></div>
<p><code>command</code> is a bash <code>builtin</code>. When used with
<code>-v</code> option, it prints a description similar to the
<code>type</code> builtin. It returns exit status <code>0</code> if
<code>$cmd</code> is executable or fails with <code>1</code> if not. As
stated before, under <code>errcode</code> (bashkit error handling
support) when <code>$cmd</code> is not available, it is a fatal error.
To be more on point, <code>check_cmd</code> should be more flexible than
silently failing (thanks to redirecting to <code>/dev/null</code>), it
could at least <code>log</code> an error. Consider the
<code>bashkit idiom</code> to just do that:</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">check_cmd()</span> <span class="kw">{</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>    <span class="bu">local</span> <span class="va">cmd</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="bu">command</span> <span class="at">-v</span> <span class="st">&quot;</span><span class="va">${cmd}</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span> /dev/null <span class="dt">\</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="kw">||</span> <span class="ex">error</span> <span class="st">&quot;</span><span class="va">${cmd}</span><span class="st"> not found&quot;</span></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="kw">}</span></span>
<span id="cb10-6"><a href="#cb10-6"></a></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="ex">bash-5.2$</span> bash <span class="at">-c</span> <span class="st">&#39;source bashkit.bash; check_cmd(){... ; check_cmd inexistent&#39;</span></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="ex">2022-10-17</span> 16:18:02+0200 [error] bash:1<span class="kw">|</span> <span class="ex">inexistent</span> not found</span></code></pre></div>
<p>It is slightly better but still lacks some genericity: what if we
just want to know if a command exists and proceed with a workaround if
not? Enter <code>raise</code> that ultimately enables more efficient
error handling patterns:</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="fu">check_cmd()</span> <span class="kw">{</span></span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="bu">local</span> <span class="va">cmd</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="bu">command</span> <span class="at">-v</span> <span class="st">&quot;</span><span class="va">${cmd}</span><span class="st">&quot;</span> <span class="op">&amp;&gt;</span> /dev/null <span class="dt">\</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="kw">||</span> <span class="ex">raise</span> <span class="st">&quot;</span><span class="va">${cmd}</span><span class="st"> not found&quot;</span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="kw">}</span></span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="ex">check_cmd</span> inexistent <span class="dt">\</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="kw">||</span> <span class="ex">error</span></span></code></pre></div>
<p>Invoked like this, <code>raise</code> position a <code>message</code>
along with the <code>exit status</code> <em>before</em> returning to the
caller. It becomes the caller’s responsibility to chose what to do when
<code>check_cmd</code> fails. For now, as previously, the script logs
the error and then crashes. But a more convenient flow is within reach
by using <code>catch</code>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="ex">check_cmd</span> isint <span class="dt">\</span></span>
<span id="cb12-4"><a href="#cb12-4"></a><span class="kw">||</span> <span class="kw">{</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="ex">catch</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">isint()</span> <span class="kw">{</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>     <span class="bu">printf</span> <span class="st">&#39;%d&#39;</span> <span class="st">&quot;</span><span class="va">$1</span><span class="st">&quot;</span> <span class="op">&gt;</span> /dev/null <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span> <span class="dt">\</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>     <span class="kw">||</span> <span class="ex">raise</span> <span class="st">&quot;invalid number: </span><span class="va">$1</span><span class="st">&quot;</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="kw">}</span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="kw">}</span></span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="ex">isint</span> 1 <span class="dt">\</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="kw">&amp;&amp;</span> <span class="ex">info</span> integer <span class="dt">\</span></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="kw">||</span> <span class="ex">error</span></span></code></pre></div>
<p>In this situation, when <code>check_cmd</code> raises a failure, the
<code>catch</code> block is able to: 1) consume this failure 2) define a
replacement function</p>
<p><code>isint</code> also complies to <code>errcode</code>: the last
invocation logs an informational “integer” (rather than error log
“invalid number”).</p>
<p>Now consider this example where <code>maybe</code> has 50% chances of
failure:</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="fu">maybe()</span><span class="kw">((</span> <span class="va">$1</span> <span class="op">&lt;</span> <span class="va">RANDOM</span><span class="op">%</span><span class="dv">100</span> <span class="kw">))</span></span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="ex">maybe</span> 50 <span class="dt">\</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="kw">&amp;&amp;</span> <span class="bu">echo</span> yep <span class="dt">\</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="kw">||</span> <span class="bu">echo</span> nope <span class="co"># not an errcode handler</span></span></code></pre></div>
<p>Bashkit error handling trap will stop short right after the
<code>maybe</code> call if it fails. In the long run, the script prints
“yep” in one out of two runs but will never print “nope”. Under
<code>errcode</code> it does not work because <code>echo</code> is not
an <em>errcode compatible handler</em>. The idiomatic way here, is to
use <code>resume</code>:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="fu">maybe()</span><span class="kw">((</span> <span class="va">$1</span> <span class="op">&lt;</span> <span class="va">RANDOM</span><span class="op">%</span><span class="dv">100</span> <span class="kw">))</span></span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="ex">maybe</span> 50 <span class="dt">\</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="kw">&amp;&amp;</span> <span class="bu">echo</span> yep <span class="dt">\</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="kw">||</span> <span class="ex">resume</span> echo nope</span></code></pre></div>
<p>This time, the script will print either “yep” or “nope” with the same
frequency. <code>resume</code> consumes the error and restores control
to the command that immediately follows, in this case:
<code>echo nope</code>.</p>
<h4 id="not-as-a-function">not as a function</h4>
<blockquote>
<p>Because bash unary negation operator <code>!</code> is not a command,
<code>resume</code> can not transfer control to it. It can be replaced
by <code>not</code>. <code>not</code> is defined to return the logical
negation of its argument.</p>
</blockquote>
<div class="sourceCode" id="cb15"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="fu">maybe()</span><span class="kw">((</span> <span class="va">$1</span> <span class="op">&lt;</span> <span class="va">RANDOM</span><span class="op">%</span><span class="dv">100</span> <span class="kw">))</span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="fu">abort()</span><span class="kw">((</span> <span class="va">RANDOM</span> <span class="op">&amp;</span> <span class="bn">0x1</span> <span class="kw">))</span></span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="ex">maybe</span> 50 <span class="dt">\</span></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="kw">||</span> <span class="ex">resume</span> not abort <span class="dt">\</span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="kw">||</span> <span class="ex">error</span> <span class="st">&#39;can not proceed&#39;</span></span></code></pre></div>
<p>In the long run, this script will rather succeed (75%) than log an
error and fail (25%).</p>
<h2 id="bashkit-scripting">Bashkit scripting</h2>
<p>Bashkit favors <code>fail fast</code> like scripting patterns: by
combining <a
href="https://www.gnu.org/software/bash/manual/html_node/Conditional-Constructs.html"><code>Conditional Constructs</code></a>
<code>[[...]]</code> and <code>((...))</code> with <code>errcode</code>
and <code>handlers</code> scripts can achieve useful and robust
behaviors. Bashkit scripts can setup LIFO <code>traps</code> on any
signal and <code>cleanup</code> command easily enables deferred actions
upon script exit. It is also very easy to add <code>text color</code> to
outputs.</p>
<h3 id="unhandled-errors">Unhandled errors</h3>
<p>Bashkit can detect a set but unhandled error that otherwise would go
silent. In this case, the script will <strong>crit</strong> log the
error:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="bu">source</span> bashkit.bash extras</span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="ex">isint</span> not_an_integer</span></code></pre></div>
<p>When ran, the above script outputs:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="ex">bash-5.2$</span> ./noint.bash</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="ex">2022-10-24</span> 15:14:52+0200 [ crit] isint:33<span class="kw">|</span> <span class="ex">invalid</span> number</span></code></pre></div>
<h3 id="fail-fast">Fail fast</h3>
<p><a
href="https://www.martinfowler.com/ieeeSoftware/failFast.pdf"><code>Fail fast</code></a>
is a simple technique that is known to ease finding most defects in a
software. A software that fails fast, will stop visibly as soon as a
problem occurs: bugs are easier to find and fix so, hopefully, fewer
make it to production.</p>
<h4 id="assertions">Assertions</h4>
<p>Usually <code>assertions</code> are different from exceptions in the
way that assertions can be turned off because they were believed useful
during design and tuning development stages. Experience has proven them
usefull even in production where <em>real</em> problems happen.</p>
<p>Bash has no support built-in support for <em>assertions</em>. Bashkit
which is mostly written in pure-bash does not either implement a
<em>per-se</em> assertion system: instead it <em>emulates</em> them
using <code>conditional construcs</code> and <code>errcode</code>:
Namely a tests followed by a <code>|| raise</code> pattern that exploits
<code>raise</code> polymorphism <em>is</em> an
<code>assertion</code>.</p>
<h4 id="example-2">Example:</h4>
<div class="sourceCode" id="cb18"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">array::pick()</span> <span class="kw">{</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>    <span class="bu">local</span> <span class="at">-n</span> <span class="va">A</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="bu">local</span> <span class="at">-n</span> <span class="va">acc</span><span class="op">=</span><span class="va">${2</span><span class="op">:-</span>__<span class="va">}</span></span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="bu">local</span> <span class="va">i</span><span class="op">=</span><span class="va">$((</span> <span class="va">RANDOM</span> <span class="op">%</span> <span class="va">${</span><span class="op">#</span><span class="va">A</span><span class="op">[@]</span><span class="va">}</span> <span class="va">))</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="bu">printf</span> <span class="at">-v</span> acc <span class="st">&#39;%s\n&#39;</span> <span class="st">&quot;</span><span class="va">${A</span><span class="op">[</span>i<span class="op">]</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="kw">}</span></span></code></pre></div>
<p><code>array::pick</code> takes two bash <a
href="https://www.gnu.org/software/bash/manual/html_node/Shell-Parameters.html">namerefs</a>.
The first one points to an array <code>A</code> while the second,
<code>acc</code>, is used to write out a random element of
<code>A</code>. Here are the things that could go wrong within this
function: 1) a wrong argument count (invocation mistake) 2)
<code>A</code> not pointing to an array 3) <code>A</code> pointing to an
empty array</p>
<p>Being a publicly exposed function of bashkit module
<code>array</code>, <code>array::pick</code> should remediate these
situations. The proper way is to add a bunch of tests akin to
<code>assertions</code> and combine <code>errcode handlers</code> to
always achieve a useful behavior:</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="fu">array::pick()</span> <span class="kw">{</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="kw">((</span> <span class="va">$#</span> <span class="op">==</span> <span class="dv">1</span> <span class="kw">||</span> <span class="va">$#</span> <span class="op">==</span> <span class="dv">2</span> <span class="kw">))</span> <span class="dt">\</span></span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="kw">||</span> <span class="ex">raise</span> <span class="st">&quot;</span><span class="va">${E_PARAM_ERR}</span><span class="st">&quot;</span> <span class="st">&#39;incorrect invocation&#39;</span> <span class="dt">\</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>    <span class="kw">||</span> <span class="ex">fatal</span></span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a>    <span class="bu">local</span> <span class="at">-n</span> <span class="va">A</span><span class="op">=</span><span class="va">$1</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>    <span class="bu">local</span> <span class="at">-n</span> <span class="va">acc</span><span class="op">=</span><span class="va">${2</span><span class="op">:-</span>__<span class="va">}</span></span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a>    <span class="ex">check::vartype</span> as A <span class="dt">\</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="kw">||</span> <span class="ex">raise</span></span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>    <span class="kw">((</span> <span class="va">${</span><span class="op">#</span><span class="va">A</span><span class="op">[@]</span><span class="va">}</span> <span class="op">!=</span> <span class="dv">0</span> <span class="kw">))</span> <span class="dt">\</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>    <span class="kw">||</span> <span class="ex">raise</span> <span class="st">&quot;</span><span class="va">${E_PARAM_ERR}</span><span class="st">&quot;</span> <span class="st">&#39;array is empty&#39;</span></span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="bu">local</span> <span class="va">i</span><span class="op">=</span><span class="va">$((</span> <span class="va">RANDOM</span> <span class="op">%</span> <span class="va">${</span><span class="op">#</span><span class="va">A</span><span class="op">[@]</span><span class="va">}</span> <span class="va">))</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>    <span class="bu">printf</span> <span class="at">-v</span> acc <span class="st">&#39;%s\n&#39;</span> <span class="st">&quot;</span><span class="va">${A</span><span class="op">[</span>i<span class="op">]</span><span class="va">}</span><span class="st">&quot;</span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="kw">}</span></span></code></pre></div>
<blockquote>
<p>This example also shows that <code>raise</code> is polymorphic.</p>
<ul>
<li>the first test <em>asserts</em> that there is either a single or 2
arguments, if not the script <code>fatals</code> immediately with exit
status <code>$E_PARAM_ERR</code> and a descriptive message</li>
<li><code>local refnames</code> assignations can not fail by design:
<code>$1</code> exists and <code>$2</code> has a default</li>
<li>bashkit <code>check::vartype</code> enables script to assert that
<code>$A</code> refers to an <em>array that has been set</em>, if not
the function (reraises the <code>check::vartype</code> failure to
<code>array::pick</code> caller</li>
<li>next test <em>asserts</em> a non-empty array and once again, raises
any failure to <code>array::pick</code> caller</li>
<li>at this point, there is no way the function could fail anymore and
it will eventually select and copy a random element from
<code>$A[@]</code> to <code>$acc</code></li>
</ul>
</blockquote>
<h3 id="traps-and-cleanup">Traps and cleanup</h3>
<p>In Bash, a process may choose to perform a different action, rather
than exiting, upon receiving a signal. This is done by setting up a
signal handler (or trap). The trap must be set before the signal is
received. A process that receives a signal for which it has set a trap
is said to have caught the signal.</p>
<p>The simplest signal handling a process can choose to perform is to
ignore a signal. This is generally a <em>bad idea</em>, unless it is
done for a very specific purpose. Ignoring signals often leads to
runaway processes which consume all available CPU.</p>
<p>Bashkit <code>trap</code> module utilities extend bash command
behavior. Namely, <code>trap::callback</code> enables a script to
register <em>multiple callback functions or plain sources</em> that are
called in LIFO order upon receiving selected signals.</p>
<p>More commonly, traps can be set up to intercept a fatal signal,
perform cleanup, and then exit gracefully. For example, a program that
creates temporary files might wish to remove them before exiting. If the
program is forced to exit by a signal, it won’t be able to remove the
files unless it catches the signal.</p>
<p>Bashkit <code>cleanup</code> utility is a <code>trap::callback</code>
wrapper dedicated to hook instructions to signal <code>EXIT/0</code>. It
can be called anytime from anywhere in the script, registered functions
will run in LIFO order at the script top level. As in bash, a mistake in
a callback could abort the entire cleanup process but won’t prevent the
script from exiting.</p>
<h4 id="example-3">Example:</h4>
<div class="sourceCode" id="cb20"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="va">scratch</span><span class="op">=</span><span class="va">$(</span><span class="fu">mktemp</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="kw">||</span> <span class="bu">exit</span></span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="ex">cleanup</span> <span class="st">&#39;rm -f &quot;${scratch}&quot;&#39;</span></span></code></pre></div>
<blockquote>
<p>When <code>panicking</code>, a bashkit script will
<code>cleanup</code> before exiting. But there are situations beyond
reach, like arithmetic exceptions or uncatchable signals that can
prevent <code>cleanup</code> to take place.</p>
</blockquote>
<h3 id="colors">Colors</h3>
<p>Bashkit provides a <code>color</code> module. For now, this module
only supports the <a
href="https://en.wikipedia.org/wiki/ANSI_escape_code">ANSI 8 colors
model</a>.</p>
<p><code>color::encode</code> supports a tiny english color description
language:</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode numberSource numberLines"><code class="sourceCode"><span id="cb21-1"><a href="#cb21-1"></a>description = color &quot;text&quot; [ color &quot;background&quot; ]</span>
<span id="cb21-2"><a href="#cb21-2"></a>            | &quot;reset&quot;</span>
<span id="cb21-3"><a href="#cb21-3"></a>color = &quot;&quot;</span>
<span id="cb21-4"><a href="#cb21-4"></a>      | attributes brightness base</span>
<span id="cb21-5"><a href="#cb21-5"></a>attributes=? a list of unique modifiers ?</span>
<span id="cb21-6"><a href="#cb21-6"></a>modifiers = &quot;&quot;</span>
<span id="cb21-7"><a href="#cb21-7"></a>          | &quot;regular&quot; | &quot;bold&quot; | &quot;dim&quot; | &quot;italic&quot; | &quot;underlined&quot; </span>
<span id="cb21-8"><a href="#cb21-8"></a>          | &quot;blinking&quot;</span>
<span id="cb21-9"><a href="#cb21-9"></a>          | modifiers, { modifiers }</span>
<span id="cb21-10"><a href="#cb21-10"></a>brightness = &quot;&quot;</span>
<span id="cb21-11"><a href="#cb21-11"></a>           | &quot;bright&quot;</span>
<span id="cb21-12"><a href="#cb21-12"></a>base = &quot;black&quot; | &quot;red&quot; | &quot;green&quot; | &quot;yellow&quot; | &quot;blue&quot; | &quot;magenta&quot; | &quot;cyan&quot;</span>
<span id="cb21-13"><a href="#cb21-13"></a>     | &quot;white&quot; | &quot;default&quot;</span></code></pre></div>
<p>The smallest descriptions of all are <code>"text"</code> and
<code>"reset"</code>. The later is always the ANSI <code>ESC[m</code>
reset code while the former is the current system-defined default.</p>
<h4 id="example-4">Example:</h4>
<div class="sourceCode" id="cb22"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="ex">color::encode</span> bold green text<span class="kw">;</span> <span class="va">bold_green</span><span class="op">=</span><span class="va">${__}</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="ex">color::encode</span> reset<span class="kw">;</span> <span class="va">reset</span><span class="op">=</span><span class="va">${__}</span></span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="bu">printf</span> <span class="st">&quot;%b%s%b&quot;</span> <span class="st">&quot;</span><span class="va">${bold_green}</span><span class="st">&quot;</span> NATURE <span class="st">&quot;</span><span class="va">${reset}</span><span class="st"> does not hurry, yet everything is accomplished\n&quot;</span></span></code></pre></div>
<blockquote>
<ul>
<li>descriptions are literals, they have no quote</li>
<li>after a successful encoding, ANSI code is stord in
<code>${__}</code></li>
<li><code>%b</code> is the required verb for an escape code when
colorizing with <code>printf</code></li>
<li>any compatible terminal that receives such codes will interpret them
as color commands</li>
</ul>
</blockquote>
<p>Declaring colors can be a tidy task, the following example shows how
to build a <em>color palette</em>:</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode numberSource bash numberLines"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1"></a><span class="bu">source</span> bashkit.bash</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="bu">declare</span> <span class="at">-A</span> <span class="va">COLPAL</span><span class="op">=</span><span class="va">(</span>  <span class="co"># color palette</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="op">[</span>panic<span class="op">]</span><span class="va">=</span><span class="st">&#39;underlined blinking bold white text red background&#39;</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  <span class="op">[</span>alert<span class="op">]</span><span class="va">=</span><span class="st">&#39;bold white text red background&#39;</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="op">[</span>crit<span class="op">]</span><span class="va">=</span><span class="st">&#39;underlined bold red text&#39;</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="op">[</span>fatal<span class="op">]</span><span class="va">=</span><span class="st">&#39;bold red text&#39;</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="op">[</span>error<span class="op">]</span><span class="va">=</span><span class="st">&#39;red text&#39;</span></span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="op">[</span>warn<span class="op">]</span><span class="va">=</span><span class="st">&#39;yellow text&#39;</span></span>
<span id="cb23-10"><a href="#cb23-10"></a>  <span class="op">[</span>note<span class="op">]</span><span class="va">=</span><span class="st">&#39;blue text&#39;</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="op">[</span>info<span class="op">]</span><span class="va">=</span><span class="st">&#39;green text&#39;</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>  <span class="op">[</span>debug<span class="op">]</span><span class="va">=</span><span class="st">&#39;magenta text&#39;</span></span>
<span id="cb23-13"><a href="#cb23-13"></a>  <span class="op">[</span>reset<span class="op">]</span><span class="va">=</span><span class="st">&#39;reset&#39;</span></span>
<span id="cb23-14"><a href="#cb23-14"></a><span class="va">)</span></span>
<span id="cb23-15"><a href="#cb23-15"></a></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="ex">color::table</span> COLPAL</span></code></pre></div>
<blockquote>
<p>The demonstrated palette is actually used by bashkit
<code>logging</code> routines.</p>
</blockquote>
<p>When called on a bash <em>dictionary</em> (ie. associative array),
<code>color::table</code> will substitute, in place, each description by
a computed ANSI <em>escape sequence</em>. The resulting dictionary is to
be used later as a <code>lookup table</code>.</p>
<h1 id="bashkitload">bashkit::load</h1>
<p>bashkit::load - load a bashkit module</p>
<h3 id="synopsis">SYNOPSIS</h3>
<p>note [<em>modname</em> …]</p>
<h3 id="description">DESCRIPTION</h3>
<p>With <em>modname</em> a string, <code>bashkit:load</code> takes an
arbitrary number of <em>modname</em> arguments. <em>modname</em> refers
to a module named <code>&lt;modname&gt;.bash</code> lying in the
hierarchy pointed by the environement variable $BASHKIT_MODPATH.</p>
<p><code>bashkit::load</code> returns success unless the module does not
exist.</p>
<h3 id="examples">EXAMPLES</h3>
<pre><code>$ bashkit load array</code></pre>
<h3 id="environment">ENVIRONMENT</h3>
<ul>
<li>$BASHKIT_MODPATH points to the modules location</li>
</ul>
<h1 id="catch">catch</h1>
<p>catch - store a raising <code>errcode</code> and resume execution</p>
<h3 id="synopsis-1">SYNOPSIS</h3>
<p>catch [<em>refname</em>]</p>
<h3 id="description-1">DESCRIPTION</h3>
<p>Catch captures and stores a raising <code>errcode</code> and then
resume execution at the first following command.</p>
<p>If no <em>refname</em> is specified, <code>errcode</code> is stored
in special bashkit variable <code>$____</code>.</p>
<p>When <code>catch</code> returns, the error context is modified:
<code>$?</code> is equal to 0.</p>
<p>Catch always returns with an exit code of zero.</p>
<h3 id="examples-1">EXAMPLES</h3>
<p><strong>Example 1 <code>true(1)</code> equivalence</strong></p>
<p>The following command will never fail, it is equivalent to using
<code>true(1)</code>.</p>
<pre><code>$ rm &quot;${TMPFILE}&quot; || catch</code></pre>
<p><strong>Example 2 Error handling</strong></p>
<p>The following command, in case of failure, will print an explanation
for <code>curl(1)</code> exit statuses [1-3] or display it
otherwise.</p>
<pre><code>$ curl &quot;${URL}&quot; &gt; /dev/null 2&gt;&amp;1 || {
    catch rc;
    case ${rc} in
      1) echo &quot;unsupported Protocol&quot;;;
      2) echo &quot;failed to initialize&quot;;;
      3) echo &quot;malformed URL&quot;;;
      *) echo &quot;curl exited with status ${rc}&quot;;;
    esac
  }</code></pre>
<h3 id="see-also">SEE ALSO</h3>
<p><code>raise(1)</code>, <code>resume(1)</code></p>
<h1 id="not">not</h1>
<p>not - unary logical not as a function</p>
<h3 id="synopsis-2">SYNOPSIS</h3>
<p>not [<em>command</em>]</p>
<h3 id="description-2">DESCRIPTION</h3>
<p><code>not</code> is the functional equivalent of <code>!</code>. It
is intended to be used with <code>resume(1)</code> that can only accept
a command as argument.</p>
<h3 id="examples-2">EXAMPLES</h3>
<p><strong>Example 1 Direct invocation</strong></p>
<p>The first following command always fails while the second always
succeeds.</p>
<pre><code>$ not true
$ not false</code></pre>
<p><strong>Example 2 Combining with <code>resume(1)</code></strong></p>
<p>The following command is equivalent to logical
<code>(green | ! red)</code>:</p>
<pre><code>$ is_green &quot;${color}&quot; || resume not is_red &quot;${color}&quot;</code></pre>
<h3 id="see-also-1">SEE ALSO</h3>
<p><code>resume(1)</code></p>
<h1 id="raise">raise</h1>
<p>raise - raise or reraise an <code>errcode</code></p>
<h3 id="synopsis-3">SYNOPSIS</h3>
<p>raise [<em>errcode</em>] [<em>errmsg</em>]</p>
<h3 id="description-3">DESCRIPTION</h3>
<p>Raise set an <em>errcode</em> and an <em>errmsg</em> and then fails
immediately.</p>
<p>Raise returns the given <em>errcode</em>. If the specified
<em>errcode</em> is zero, the exit status defaults to one. When no
<em>errcode</em> is specified, <code>raise</code> returns either the
last positionned <code>errcode</code> or defaults to one if none.</p>
<p>If <em>errmsg</em> is not given, <code>raise</code> uses the last
positionned one or defaults to none.</p>
<h3 id="examples-3">EXAMPLES</h3>
<p><strong>Example 1 Direct invocation</strong></p>
<p>The following command always fails, here <code>raise</code> is
equivalent to <code>false(1)</code>.</p>
<pre><code>$ raise</code></pre>
<p><strong>Example 2 Direct invocation with arguments</strong></p>
<p>The first two commands fail with exit status 2, the last one with 1.
In the last two, an error message is also positionned.</p>
<pre><code>$ raise 2
$ raise 2 &quot;error message&quot;
$ raise &quot;error message&quot;</code></pre>
<p><strong>Example 3 Raising last exit status</strong></p>
<p>The following commands will raise the exit status returned by
<code>rm(1)</code> along with an error message for the second one.</p>
<pre><code>$ rm &quot;${TMPFILE}&quot; \
  || raise
$ rm &quot;${TMPFILE}&quot; \
  || raise &quot;cannot rm ${TMPFILE}&quot;</code></pre>
<p><strong>Example 4 Raising exit status through calling
stack</strong></p>
<p>The following script will log an error and then exit with status 1.
The exit status is set in <code>isint</code> and reused upon return by
<code>error(1)</code>.</p>
<pre><code>#!/usr/bin/env bash
# isint.bash -- bashkit example
source bashkit.bash

isint() {
  local n
  printf -v n &#39;%d&#39; &quot;${1:-}&quot; &amp;&gt; /dev/null \
  || raise &quot;not an int&quot;
}

isint &quot;abc&quot; \
|| error

$ bash isint.bash
2022-10-31 20:44:01+0100 [error] isint:8| not an int</code></pre>
<p><strong>Example 5 Relocating errors throughout calling
points</strong></p>
<p>In the above example, the error message traced back into
<code>isint</code>. It is sometimes usefull to relocate the error at the
calling point:</p>
<pre><code>#!/usr/bin/env bash
# isint.bash -- bashkit example
source bashkit.bash

isint() {
  local n
  printf -v n &#39;%d&#39; &quot;${1:-}&quot; &amp;&gt; /dev/null \
  || raise &quot;not an int&quot;
}

isint &quot;abc&quot; \
|| raise \
|| error

$ bash isint.bash
2022-10-31 20:47:38+0100 [error] isint.bash:13| not an int</code></pre>
<h3 id="see-also-2">SEE ALSO</h3>
<p><code>catch(1)</code>, <code>resume(1)</code></p>
<h1 id="resume">resume</h1>
<p>resume - abort a raising <code>errcode</code> and resume
execution</p>
<h3 id="synopsis-4">SYNOPSIS</h3>
<p>resume [<em>command</em>]</p>
<h3 id="description-4">DESCRIPTION</h3>
<p>Unlike <code>catch(1)</code>, <code>resume</code> executes in the
<em>same context</em> as the error. It allows the flow of control to
abort the raising <code>errcode</code> and to recover execution by
running the command that follows it.</p>
<h3 id="examples-4">EXAMPLES</h3>
<p><strong>Example 1 Direct invocation</strong></p>
<p>The following command always succeed, here <code>resume</code> is
equivalent to builtin <code>:</code>.</p>
<pre><code>$ resume</code></pre>
<p><strong>Example 2 Direct invocation with a command
argument</strong></p>
<p>The following command displays a message, here <code>resume</code> is
a no-op:</p>
<pre><code>$ resume echo &quot;resumed!&quot;</code></pre>
<p><strong>Example 3 Error flow of control handling</strong></p>
<pre><code>$ (( n &gt; 0 &amp;&amp; n &amp; 0x1 )) &amp;&amp; echo &quot;odd&quot; || resume echo &quot;even&quot;</code></pre>
<p>Without <code>resume</code> the above command will stop short
<em>before</em> <code>||</code> for any even number: it will not display
“even”.</p>
<p><strong>Example 4 Combining with <code>not(1)</code> or builtin
<code>let</code></strong></p>
<p><code>resume</code> argument must be a <em>command</em>, unary
operator or litteral values are not supported. This is why we have to
use <code>not(1)</code> in the following construct:</p>
<pre><code>$ is_green &quot;${color}&quot; || resume not is_red &quot;${color}&quot;</code></pre>
<p>The same goes for assignations:</p>
<pre><code>$ is_even &quot;${x}&quot; || resume let x=$((x + 1))</code></pre>
<h3 id="see-also-3">SEE ALSO</h3>
<p><code>catch(1)</code>, <code>raise(1)</code>, <code>not(1)</code></p>
<h1 id="colorencode">color::encode</h1>
<p>color::encode - compute an 8 colors ANSI code from a color
description</p>
<h3 id="synopsis-5">SYNOPSIS</h3>
<p>color::encode [<em>description</em>]</p>
<h3 id="description-5">DESCRIPTION</h3>
<p><code>color::encode</code> encodes a color description into an ANSI
color escape code. The code is always stored in special bashkit variable
<code>$__</code>.</p>
<p>If no <em>description</em> is specified, the code defaults to
<code>ESC[m</code>, the reset code.</p>
<p>The description must be written according to the following
grammar:</p>
<pre><code>description = color &quot;text&quot; [ color &quot;background&quot; ]
            | &quot;reset&quot;

color = &quot;&quot;
      | attributes brightness base

attributes=? a list of unique modifiers ?

modifiers = &quot;&quot;
          | &quot;regular&quot; | &quot;bold&quot; | &quot;dim&quot; | &quot;italic&quot; | &quot;underlined&quot; | &quot;blinking&quot;
          | modifiers, { modifiers }

brightness = &quot;&quot;
           | &quot;bright&quot;

base = &quot;black&quot; | &quot;red&quot; | &quot;green&quot; | &quot;yellow&quot;
     | &quot;blue&quot; | &quot;magenta&quot; | &quot;cyan&quot; | &quot;white&quot;
     | &quot;default&quot;</code></pre>
<p>The smallest descriptions of all are <code>"text"</code> and
<code>"reset"</code>. The later is always the ANSI <code>ESC[m</code>
reset code while the former is the current system-defined default.</p>
<p><code>color::encode</code> returns with an exit code of zero upon
successful encoding. It returns <code>E_PARAM_ERR/9</code>
otherwise.</p>
<h3 id="examples-5">EXAMPLES</h3>
<p>The description must always be written without quote when invoking
directly:</p>
<pre><code>  $ color::encode underlined blinking bold white text red background
  $ echo &quot;${__}&quot;
  \x1b[4;5;1;37;41m</code></pre>
<h3 id="see-also-4">SEE ALSO</h3>
<p>https://en.wikipedia.org/wiki/ANSI_escape_code</p>
<p><code>color::table(1)</code></p>
<h1 id="coloris_enabled">color::is_enabled</h1>
<p>color::is_enabled - test if color is supported</p>
<h3 id="synopsis-6">SYNOPSIS</h3>
<p>color::is_enabled</p>
<h3 id="description-6">DESCRIPTION</h3>
<p><code>color::is_enabled</code> test if color is not <em>disabled</em>
and terminal is compatible. One can <em>disable</em> color by setting
<code>$NO_COLOR</code> before running scripts.</p>
<p><code>color::is_enabled</code> returns 0 if colors are available and
&gt;0 otherwise.</p>
<h3 id="example-5">EXAMPLE</h3>
<pre><code>$ color::is_enabled &amp;&amp; echo &quot;colors are available&quot; || resume echo &quot;no color&quot;</code></pre>
<h3 id="see-also-5">SEE ALSO</h3>
<p><code>color::encode(1)</code>, <code>color::table(1)</code></p>
<h1 id="colortable">color::table</h1>
<p>color::table - compute 8 colors ANSI code from a description
dictionary</p>
<h3 id="synopsis-7">SYNOPSIS</h3>
<p>color::table [<em>dict</em>]</p>
<h3 id="description-7">DESCRIPTION</h3>
<p><code>color::table</code> replaces descriptions found in an
associative array by corresponding ASCII 8-color codes. The
<em>dict</em> can subsequently be used as a
<code>lookup table</code>.</p>
<p>The descriptions must be written for
<code>color::encode(1)</code>.</p>
<p>If there is a type mismatch or if <em>dict</em> is undefined,
<code>color::table</code> panics by calling <code>fatal(1)</code>.</p>
<p><code>color::table</code> returns with an exit code of zero upon
successful encoding. It errors with exit status
<code>E_PARAM_ERR/9</code> otherwise. The content of the original dict
is undefined in the later case.</p>
<h3 id="example-6">EXAMPLE</h3>
<pre><code>$ declare -A COLPAL=(  # color palette
    [panic]=&#39;underlined blinking bold white text red background&#39;
    [alert]=&#39;bold white text red background&#39;
    [crit]=&#39;underlined bold red text&#39;
    [fatal]=&#39;bold red text&#39;
    [error]=&#39;red text&#39;
    [warn]=&#39;yellow text&#39;
    [note]=&#39;blue text&#39;
    [info]=&#39;green text&#39;
    [debug]=&#39;magenta text&#39;
    [reset]=&#39;reset&#39;
  )
$ color::table COLPAL
$ echo &quot;${COLPAL[panic]}&quot;
\x1b[4;5;1;37;41m</code></pre>
<h3 id="see-also-6">SEE ALSO</h3>
<p><code>color::encode(1)</code>, <code>error(1)</code>,
<code>fatal(1)</code></p>
<h1 id="breakpoint">breakpoint</h1>
<p>breakpoint - set an intentional pausing place for debugging
purpose</p>
<h3 id="synopsis-8">SYNOPSIS</h3>
<p>breakpoint</p>
<h3 id="description-8">DESCRIPTION</h3>
<p>When used in conjunction of <code>errcode::trap breakpoint</code>
mode or if <code>$DEBUG</code> is set beforehand,
<code>breakpoint</code> pauses the script and throws a minimal console
to <code>/dev/tty</code>. Otherwise, <code>breakpoint</code> is a
no-op.</p>
<h3 id="example-7">EXAMPLE</h3>
<pre><code>$ errcode::trap breakpoint
$ breakpoint
# breakpoint (0)
debug&gt;</code></pre>
<h3 id="see-also-7">SEE ALSO</h3>
<p><code>errcode::trap(1)</code></p>
<h1 id="errcodetrap">errcode::trap</h1>
<p>errcode::trap - get or set <code>errcode</code> mode</p>
<h3 id="synopsis-9">SYNOPSIS</h3>
<p>errcode::trap [<em>command</em>]</p>
<h3 id="description-9">DESCRIPTION</h3>
<p><em>command</em> is one of <code>default</code> | <code>enable</code>
| <code>disable</code> | <code>breakpoint</code> | <code>status</code>.
If no <em>command</em> is given, it defaults to <code>status</code>.
<code>errcode::trap</code> panics by calling <code>fatal(1)</code>
otherwise.</p>
<p><code>errcode::trap</code> returns with an exit code of zero if a
<code>errcode</code> is enabled, &gt;0 otherwise.</p>
<p><em>Disabling <code>errcode</code> <code>trap</code> is strongly
discouraged as it may result in non obvious bad script side
effects</em>.</p>
<h3 id="example-8">EXAMPLE</h3>
<pre><code>$ errcode::trap \
&amp;&amp; echo &quot;errcode trap is enabled&quot; \
|| resume echo &quot;errcode is disabled&quot;
errcode is enabled</code></pre>
<h3 id="see-also-8">SEE ALSO</h3>
<p><code>breakpoint(1)</code></p>
<h1 id="errorclass">error::class</h1>
<p>error::class - error classifying tool</p>
<h3 id="synopsis-10">SYNOPSIS</h3>
<p>error::class <em>error</em></p>
<h3 id="description-10">DESCRIPTION</h3>
<p>With <em>error</em> either a positive integer in range [0-255] or a
valid name:</p>
<pre><code>^E_([A-Z1-9]+)((_([A-Z1-9])+)*)$</code></pre>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>range</th>
<th>names</th>
<th>owner</th>
<th>note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-3</td>
<td>E_SUCCESS - E_UNSUPPORTED</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>4-7</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="odd">
<td>8-32</td>
<td>E_BASHKIT - E_CUSTOM</td>
<td>bashkit</td>
<td>highest bit is 3 or 4</td>
</tr>
<tr class="even">
<td>33-123</td>
<td>custom names</td>
<td>user</td>
<td>highest bit is 5 or 6 but lesser than 124</td>
</tr>
<tr class="odd">
<td>124-128</td>
<td>E_TIMEOUT - E_INVALID_EXIT</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>129-192</td>
<td>E_SIGHUP - E_SIGRTMAX</td>
<td>signal</td>
<td>highest bit is 7 low bits for signum</td>
</tr>
<tr class="odd">
<td>193-254</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="even">
<td>255</td>
<td>E_OUT_OF_RANGE</td>
<td>bash</td>
<td></td>
</tr>
</tbody>
</table>
<p>The queried error class is printed on <code>stdout</code>
<em>and</em> stored in special variable <code>$__</code>.</p>
<p><code>error::class</code> returns 0 on success &gt;0 otherwise.</p>
<h3 id="examples-6">EXAMPLES</h3>
<pre><code>$ error::class 129
signal
$ error::class E_SIGHUP
signal</code></pre>
<h3 id="see-also-9">SEE ALSO</h3>
<p><code>error::custom(1)</code>, <code>error::list(1)</code>,
<code>error::whatis(1)</code></p>
<h1 id="errorcustom">error::custom</h1>
<p>error::custom - register a custom error</p>
<h3 id="synopsis-11">SYNOPSIS</h3>
<p>error::custom <em>rawname</em> <em>rawcode</em></p>
<h3 id="description-11">DESCRIPTION</h3>
<p>With <em>rawname</em> a string and <em>rawcode</em> a positive
integer in range [1-90], <code>error::custom</code> registers
<code>$E_&lt;RAWerror::custom&gt;</code> wich equals
<code>$E_CUSTOM</code> + <em>rawcode</em>.</p>
<p><em>rawname</em> is valid if it matches:</p>
<pre><code>^E_([A-Z1-9]+)((_([A-Z1-9])+)*)$</code></pre>
<p><code>error::custom</code> returns 0 if successful. It returns
<code>$E_PARAM_ERR</code> when <em>rawname</em> or <em>rawcode</em> are
already defined or if <em>rawcode</em> is out of range.</p>
<h3 id="example-9">EXAMPLE</h3>
<pre><code>$ error::custom empty_buffer 1
$ echo &quot;${__}&quot;
E_EMPTY_BUFFER=33
$ echo ${E_EMPTY_BUFFER}
33</code></pre>
<h3 id="see-also-10">SEE ALSO</h3>
<p><code>error::class(1)</code>, <code>error::list(1)</code>,
<code>error::whatis(1)</code></p>
<h1 id="errorlist">error::list</h1>
<p>error::list - error class listing tool</p>
<h3 id="synopsis-12">SYNOPSIS</h3>
<p>error::list <em>errclass</em></p>
<h3 id="description-12">DESCRIPTION</h3>
<p>With <em>errclass</em> is one of <code>all</code> | <code>bash</code>
| <code>bashkit</code> | <code>custom</code> | <code>signal</code>. When
<em>errclass</em> is not given it defaults to <code>all</code>.
<code>error::list</code> panics by calling <code>fatal(1)</code>
otherwise.</p>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>range</th>
<th>names</th>
<th>owner</th>
<th>note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-3</td>
<td>E_SUCCESS - E_UNSUPPORTED</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>4-7</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="odd">
<td>8-32</td>
<td>E_BASHKIT - E_CUSTOM</td>
<td>bashkit</td>
<td>highest bit is 3 or 4</td>
</tr>
<tr class="even">
<td>33-123</td>
<td>custom names</td>
<td>user</td>
<td>highest bit is 5 or 6 but lesser than 124</td>
</tr>
<tr class="odd">
<td>124-128</td>
<td>E_TIMEOUT - E_INVALID_EXIT</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>129-192</td>
<td>E_SIGHUP - E_SIGRTMAX</td>
<td>signal</td>
<td>highest bit is 7 low bits for signum</td>
</tr>
<tr class="odd">
<td>193-254</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="even">
<td>255</td>
<td>E_OUT_OF_RANGE</td>
<td>bash</td>
<td></td>
</tr>
</tbody>
</table>
<p>The queried error list is printed on <code>stdout</code>.</p>
<p><code>error::list</code> always returns 0 unless invoked with a bad
<em>errclass</em>.</p>
<h3 id="example-10">EXAMPLE</h3>
<pre><code>$ error::list | column -t -s &quot;=&quot;
E_SUCCESS            0
E_FAILURE            1
...
E_SIGRTMAX           192</code></pre>
<h3 id="see-also-11">SEE ALSO</h3>
<p><code>error::class(1)</code>, <code>error::custom(1)</code>,
<code>error::whatis(1)</code></p>
<h1 id="errorwhatis">error::whatis</h1>
<p>error::whatis - bidirectional mapper between error codes and
names</p>
<h3 id="synopsis-13">SYNOPSIS</h3>
<p>error::whaits <em>error</em></p>
<h3 id="description-13">DESCRIPTION</h3>
<p>With <em>error</em> either a positive integer in range [0-255] or a
valid name:</p>
<pre><code>^E_([A-Z1-9]+)((_([A-Z1-9])+)*)$</code></pre>
<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>range</th>
<th>names</th>
<th>owner</th>
<th>note</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0-3</td>
<td>E_SUCCESS - E_UNSUPPORTED</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>4-7</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="odd">
<td>8-32</td>
<td>E_BASHKIT - E_CUSTOM</td>
<td>bashkit</td>
<td>highest bit is 3 or 4</td>
</tr>
<tr class="even">
<td>33-123</td>
<td>custom names</td>
<td>user</td>
<td>highest bit is 5 or 6 but lesser than 124</td>
</tr>
<tr class="odd">
<td>124-128</td>
<td>E_TIMEOUT - E_INVALID_EXIT</td>
<td>bash</td>
<td></td>
</tr>
<tr class="even">
<td>129-192</td>
<td>E_SIGHUP - E_SIGRTMAX</td>
<td>signal</td>
<td>highest bit is 7 low bits for signum</td>
</tr>
<tr class="odd">
<td>193-254</td>
<td>N/A</td>
<td>unused</td>
<td></td>
</tr>
<tr class="even">
<td>255</td>
<td>E_OUT_OF_RANGE</td>
<td>bash</td>
<td></td>
</tr>
</tbody>
</table>
<p>The queried error code/name is printed on <code>stdout</code>
<em>and</em> stored in special variable <code>$__</code>.</p>
<p><code>error::whatis</code> returns 0 on success &gt;0 otherwise.</p>
<h3 id="examples-7">EXAMPLES</h3>
<pre><code>$ error::whatis 129
E_SIGHUP
$ error::class E_SIGHUP
129</code></pre>
<h3 id="see-also-12">SEE ALSO</h3>
<p><code>error::class</code>, <code>error::custom(1)</code>,
<code>error::list(1)</code></p>
<h1 id="alert">alert</h1>
<p>alert - display an alert message</p>
<h3 id="synopsis-14">SYNOPSIS</h3>
<p>alert [<em>message</em> …]</p>
<h3 id="description-14">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>alert</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code> or by calling
<code>raise(1)</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 1 beforehand or set at runtime
each message argument is displayed on its own.</p>
<p><code>alert</code> is an <code>errcode</code> handler, it returns
previous <code>$?</code> unless a write or assignment error occurs.</p>
<h3 id="examples-8">EXAMPLES</h3>
<pre><code>$ alert
2022-11-07 16:50:12+0100 [alert] bash:1|

$ alert &quot;alert message&quot;
2022-11-07 16:50:14+0100 [alert] bash:1| alert message

$ __=&#39;preset error&#39;; false \
|| alert
2022-11-07 16:52:11+0100 [alert] bash:1| preset error

$ false || alert &#39;failure!&#39;
2022-11-07 16:53:44+0100 [alert] bash:1| failure!

$ false \
  || raise &quot;${E_PARAM_ERR}&quot; &#39;not good&#39; \
  || alert
2022-11-07 16:59:33+0100 [alert] bash:1| not good</code></pre>
<h3 id="environment-1">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-13">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code>,
<code>errcode::trap(1)</code>, <code>raise(1)</code></p>
<h1 id="crit">crit</h1>
<p>crit - display a critical message</p>
<h3 id="synopsis-15">SYNOPSIS</h3>
<p>crit [<em>message</em> …]</p>
<h3 id="description-15">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>crit</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code> or by calling
<code>raise(1)</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 2 beforehand or set at runtime
each message argument is displayed on its own.</p>
<p><code>crit</code> is an <code>errcode</code> handler, it returns
previous <code>$?</code> unless a write or assignment error occurs.</p>
<h3 id="examples-9">EXAMPLES</h3>
<pre><code>$ crit
2022-11-07 16:50:12+0100 [crit] bash:1|

$ crit &quot;crit message&quot;
2022-11-07 16:50:14+0100 [crit] bash:1| crit message

$ __=&#39;preset error&#39;; false \
|| crit
2022-11-07 16:52:11+0100 [crit] bash:1| preset error

$ false || crit &#39;failure!&#39;
2022-11-07 16:53:44+0100 [crit] bash:1| failure!

$ false \
  || raise &quot;${E_PARAM_ERR}&quot; &#39;not good&#39; \
  || crit
2022-11-07 16:59:33+0100 [crit] bash:1| not good</code></pre>
<h3 id="environment-2">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-14">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code>,
<code>errcode::trap(1)</code>, <code>raise(1)</code></p>
<h1 id="debug">debug</h1>
<p>debug - display a debugging message</p>
<h3 id="synopsis-16">SYNOPSIS</h3>
<p>debug [<em>message</em> …]</p>
<h3 id="description-16">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>debug</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code>.</p>
<p>If <code>$LOGLEVEL</code> is set to 7 beforehand or at runtime each
message is displayed on its own.</p>
<p>When <code>$TRACE</code> or <code>$REPORT</code> are set,
<code>$LOGLEVEL</code> defaults to 7</p>
<p><code>debug</code> returns success unless a write or assignment error
occurs.</p>
<h3 id="examples-10">EXAMPLES</h3>
<pre><code>$ debug
2022-11-08 00:59:32+0100 [debug] bash:1|

$ debug &quot;debug message&quot;
2022-11-08 01:00:03+0100 [debug] bash:1| debug message

$ __=&#39;preset message&#39; &amp;&amp; debug
2022-11-08 01:00:57+0100 [debug] bash:1| preset message</code></pre>
<h3 id="environment-3">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-15">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code></p>
<h1 id="error">error</h1>
<p>error - display an error message</p>
<h3 id="synopsis-17">SYNOPSIS</h3>
<p>error [<em>message</em> …]</p>
<h3 id="description-17">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>error</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code> or by calling
<code>raise(1)</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 3 beforehand or set during runtime
each message is displayed on its own.</p>
<p><code>error</code> is an <code>errcode</code> handler, it returns
previous <code>$?</code> unless a write or assignment error occurs.</p>
<h3 id="examples-11">EXAMPLES</h3>
<pre><code>$ error
2022-11-07 16:50:12+0100 [error] bash:1|

$ error &quot;error message&quot;
2022-11-07 16:50:14+0100 [error] bash:1| error message

$ __=&#39;preset error&#39;; false \
|| error
2022-11-07 16:52:11+0100 [error] bash:1| preset error

$ false || error &#39;failure!&#39;
2022-11-07 16:53:44+0100 [error] bash:1| failure!

$ false \
  || raise &quot;${E_PARAM_ERR}&quot; &#39;not good&#39; \
  || error
2022-11-07 16:59:33+0100 [error] bash:1| not good</code></pre>
<h3 id="environment-4">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-16">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code>,
<code>errcode::trap(1)</code>, <code>raise(1)</code></p>
<h1 id="fatal">fatal</h1>
<p>fatal - display a message and panic with an error code</p>
<h3 id="synopsis-18">SYNOPSIS</h3>
<p>fatal [<em>message</em> …]</p>
<h3 id="description-18">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>fatal</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code> or by calling
<code>raise(1)</code>.</p>
<p>Each message is always displayed on its own.</p>
<p><code>fatal</code> is an <code>errcode</code> handler, it returns
previous <code>$?</code> unless a write or assignment error occurs. If
previous <code>$?</code> is 0, <code>fatal</code> defaults to 1.</p>
<h3 id="examples-12">EXAMPLES</h3>
<pre><code>$ fatal
2022-11-07 16:50:12+0100 [fatal] bash:1|

$ fatal &quot;fatal message&quot;
2022-11-07 16:50:14+0100 [fatal] bash:1| fatal message

$ __=&#39;preset fatal&#39;; false \
|| fatal
2022-11-07 16:52:11+0100 [fatal] bash:1| preset fatal

$ false || fatal &#39;failure!&#39;
2022-11-07 16:53:44+0100 [fatal] bash:1| failure!

$ false \
  || raise &quot;${E_PARAM_ERR}&quot; &#39;not good&#39; \
  || fatal
2022-11-07 16:59:33+0100 [fatal] bash:1| not good</code></pre>
<h3 id="environment-5">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-17">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code>,
<code>errcode::trap(1)</code>, <code>raise(1)</code></p>
<h1 id="info">info</h1>
<p>info - display an informational message</p>
<h3 id="synopsis-19">SYNOPSIS</h3>
<p>info [<em>message</em> …]</p>
<h3 id="description-19">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>info</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 6 beforehand or set at runtime
each message is displayed on its own.</p>
<p><code>info</code> returns success unless a write or assignment error
occurs.</p>
<p><code>info</code> shadows <code>info(1)</code> the bash info document
reader. If you need to use this reader, invoke it with
<code>command</code> <code>info</code>.</p>
<h3 id="examples-13">EXAMPLES</h3>
<pre><code>$ info
2022-11-08 00:59:32+0100 [info] bash:1|

$ info &quot;info message&quot;
2022-11-08 01:00:03+0100 [info] bash:1| info message

$ __=&#39;preset message&#39; &amp;&amp; info
2022-11-08 01:00:57+0100 [info] bash:1| preset message</code></pre>
<h3 id="environment-6">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-18">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code></p>
<p>for <code>info(1)</code> disambiguation:</p>
<p>builtin <code>command</code>, <code>info(1)</code></p>
<pre><code>$ command [-pVv] info [arg ...]</code></pre>
<h1 id="logginglevel">logging::level</h1>
<p>logging::level - display the current logging level</p>
<h3 id="synopsis-20">SYNOPSIS</h3>
<p>logging::level</p>
<h3 id="description-20">DESCRIPTION</h3>
<p><code>logging::level</code> displays the current script logging level
on <code>stdout</code>.</p>
<p>It returns success unless a write or assignment error occurs.</p>
<h3 id="examples-14">EXAMPLES</h3>
<pre><code>$ logging::level
6</code></pre>
<h3 id="environment-7">ENVIRONMENT</h3>
<ul>
<li>$LOGLEVEL controls the logging level</li>
</ul>
<h3 id="see-also-19">SEE ALSO</h3>
<p><code>logging::setlevel(1)</code></p>
<h1 id="note">note</h1>
<p>note - display a note message</p>
<h3 id="synopsis-21">SYNOPSIS</h3>
<p>note [<em>message</em> …]</p>
<h3 id="description-21">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>note</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 5 beforehand or set at runtime
each message is displayed on its own.</p>
<p><code>note</code> returns success unless a write or assignment error
occurs.</p>
<h3 id="examples-15">EXAMPLES</h3>
<pre><code>$ note
2022-11-08 00:59:32+0100 [note] bash:1|

$ note &quot;note message&quot;
2022-11-08 01:00:03+0100 [note] bash:1| note message

$ __=&#39;preset message&#39; &amp;&amp; note
2022-11-08 01:00:57+0100 [note] bash:1| preset message</code></pre>
<h3 id="environment-8">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-20">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code></p>
<h1 id="panic">panic</h1>
<p>panic - display a message and panic with error code 1</p>
<h3 id="synopsis-22">SYNOPSIS</h3>
<p>panic [<em>message</em> …]</p>
<h3 id="description-22">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>panic</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code> or by calling
<code>raise(1)</code>.</p>
<p>Each message is always displayed on its own.</p>
<p><code>panic</code> is an <code>errcode</code> handler, it returns
1.</p>
<h3 id="examples-16">EXAMPLES</h3>
<pre><code>$ panic
2022-11-07 16:50:12+0100 [panic] bash:1|

$ panic &quot;panic message&quot;
2022-11-07 16:50:14+0100 [panic] bash:1| panic message

$ __=&#39;preset panic&#39;; false \
|| panic
2022-11-07 16:52:11+0100 [panic] bash:1| preset panic

$ false || panic &#39;failure!&#39;
2022-11-07 16:53:44+0100 [panic] bash:1| failure!

$ false \
  || raise &quot;${E_PARAM_ERR}&quot; &#39;not good&#39; \
  || panic
2022-11-07 16:59:33+0100 [panic] bash:1| not good</code></pre>
<h3 id="environment-9">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-21">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code>,
<code>errcode::trap(1)</code>, <code>raise(1)</code></p>
<h1 id="loggingsetlevel">logging::setlevel</h1>
<p>logging::setlevel - modify the current logging level</p>
<h3 id="synopsis-23">SYNOPSIS</h3>
<p>logging::setlevel [<em>level</em>]</p>
<h3 id="description-23">DESCRIPTION</h3>
<p>With <em>level</em> either an integer in [0-7] or a string in: panic
| emerg | alert | crit | error | warn | note | info | debug,
<code>logging::setlevel</code> sets the current script logging
level.</p>
<p>If <em>level</em> is invalid, the logging level defaults to
INFO/6.</p>
<p><code>logging::setlevel</code> returns success.</p>
<h3 id="examples-17">EXAMPLES</h3>
<pre><code>$ logging::setlevel 7
$ logging::setlevel debug</code></pre>
<h3 id="environment-10">ENVIRONMENT</h3>
<ul>
<li>$LOGLEVEL controls the logging level</li>
</ul>
<h3 id="see-also-22">SEE ALSO</h3>
<p><code>logging::level(1)</code></p>
<h1 id="warn">warn</h1>
<p>warn - display a warn message</p>
<h3 id="synopsis-24">SYNOPSIS</h3>
<p>warn [<em>message</em> …]</p>
<h3 id="description-24">DESCRIPTION</h3>
<p>With <em>message</em> a string, <code>warn</code> takes an arbitrary
number of <em>message</em> arguments. <em>message</em> can be set in
special variable <code>$__</code>.</p>
<p>If <code>$LOGLEVEL</code> is &gt;= 4 beforehand or set at runtime
each message is displayed on its own.</p>
<p><code>warn</code> returns success unless a write or assignment error
occurs.</p>
<h3 id="examples-18">EXAMPLES</h3>
<pre><code>$ warn
2022-11-08 00:59:32+0100 [warn] bash:1|

$ warn &quot;warn message&quot;
2022-11-08 01:00:03+0100 [warn] bash:1| warn message

$ __=&#39;preset message&#39; &amp;&amp; warn
2022-11-08 01:00:57+0100 [warn] bash:1| preset message</code></pre>
<h3 id="environment-11">ENVIRONMENT</h3>
<ul>
<li>$JSON controls the output format</li>
<li>$LOGLEVEL controls the logging level</li>
<li>$NO_COLOR controls the output colorization</li>
</ul>
<h3 id="see-also-23">SEE ALSO</h3>
<p><code>logging::level(1)</code>, <code>logging::setlevel(1)</code></p>
<h1 id="trapcallback">trap::callback</h1>
<p>trap::callback - hook a command to a signal</p>
<h3 id="synopsis-25">SYNOPSIS</h3>
<p>trap::callback [[<em>arg</em>] <em>signal_spec</em> …]</p>
<h3 id="description-25">DESCRIPTION</h3>
<p><code>trap::callback</code> is a wrapper to bash builtin trap that
goes the extra mile of stacking up <em>arg</em> to already hooked up
commands.</p>
<p><em>arg</em> and <em>signal_spec</em> are defined in builtin
<code>trap</code> help.</p>
<p>Upon reception of <em>signal_spec</em>, the commands are executed in
LIFO order.</p>
<h3 id="example-11">EXAMPLE</h3>
<pre><code>$ trap::callback &quot;echo goodbye world!&quot; EXIT
goodbye world!</code></pre>
<h3 id="see-also-24">SEE ALSO</h3>
<p>builtin <code>trap</code>, <code>cleanup(1)</code></p>
<h1 id="cleanup">cleanup</h1>
<p>cleanup - hook a command to the EXIT signal</p>
<h3 id="synopsis-26">SYNOPSIS</h3>
<p>cleanup [<em>arg</em>]</p>
<h3 id="description-26">DESCRIPTION</h3>
<p><code>cleanup</code> is a wrapper to bashkit
<code>trap::callback</code> on the EXIT signal.</p>
<p><em>arg</em> is defined in bash builtin trap help.</p>
<p>Upon reception of EXIT, the commands are executed in LIFO order.</p>
<h3 id="examples-19">EXAMPLES</h3>
<pre><code>$ cleanup &quot;echo goodbye world!&quot;
goodbye world!
$ touch /tmp/tmpfile &amp;&amp; cleanup &#39;rm -f /tmp/tmpfile&#39;</code></pre>
<h3 id="see-also-25">SEE ALSO</h3>
<p>builtin <code>trap</code>, <code>trap::callback(1)</code></p>
<h1 id="arraycontains">array::contains</h1>
<p>array::contains - test if an array contains a given value</p>
<h3 id="synopsis-27">SYNOPSIS</h3>
<p>array::contains <em>A</em> <em>x</em> [<em>idx</em>]</p>
<h3 id="description-27">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <em>x</em> a value and
<em>idx</em> a variable, <code>array::contains</code> test if <em>x</em>
exists in <em>A</em> and set <em>idx</em> to <em>x</em> index. If
<em>idx</em> is not given, the index is set in special variable
<code>$__</code>.</p>
<p><code>array::contains</code> returns 0 if <em>x</em> in <em>A</em>,
&gt;0 otherwise or if an error occurs.</p>
<h3 id="example-12">EXAMPLE</h3>
<pre><code>$ declare -a ARRAY=( 1 2 3 4 )
$ array::contains ARRAY 2 idx
$ echo $?
0
$ echo &quot;${ARRAY[idx]}&quot;
2</code></pre>
<h1 id="arrayinter">array::inter</h1>
<p>array::inter - intersect two arrays</p>
<h3 id="synopsis-28">SYNOPSIS</h3>
<p>array::inter <em>A</em> <em>B</em></p>
<h3 id="description-28">DESCRIPTION</h3>
<p>With <em>A</em> et <em>B</em> array variables,
<code>array::inter</code> intersects <em>A</em> and <em>B</em> and set
the resulting array in <em>A</em>.</p>
<p><code>array::inter</code> returns 0 unless wrong arguments or error
&gt;0.</p>
<h3 id="example-13">EXAMPLE</h3>
<pre><code>$ declare -a A=( hello world 1 2 3 4 )
$ declare -a B=( 3 4 5 6 goodbye world )
$ array::inter A B
$ echo &quot;${A[@]}&quot;
3 4 world</code></pre>
<h1 id="arraymap">array::map</h1>
<p>array::map - apply a function to an array elements</p>
<h3 id="synopsis-29">SYNOPSIS</h3>
<p>array::map <em>A</em> <em>fun</em></p>
<h3 id="description-29">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>fun</em> a bash function
that transforms <code>$1</code> and prints the result to
<code>stdout</code>, <code>array::map</code> applies <em>fun</em> in
place to each elements of <em>A</em>.</p>
<p><code>array::map</code> returns 0 upon success &gt;0 otherwise.</p>
<h3 id="examples-20">EXAMPLES</h3>
<pre><code>$ declare -a A=( {a..e} )
$ up(){ echo ${1^^}; }
$ array::map A up
$ echo &quot;${A[@]}&quot;
A B C D E</code></pre>
<h3 id="see-also-26">SEE ALSO</h3>
<p><code>array::reduce(1)</code></p>
<h1 id="arraypick">array::pick</h1>
<p>array::pick - pick a random array element</p>
<h3 id="synopsis-30">SYNOPSIS</h3>
<p>array::pick <em>A</em> [<em>x</em>]</p>
<h3 id="description-30">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>x</em> a variable,
<code>array::pick</code> sets <em>x</em> to a random element of
<em>A</em>. If <em>x</em> is not specified, it defaults to the special
variable <code>$__</code>.</p>
<p><code>array::pick</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-14">EXAMPLE</h3>
<pre><code>$ declare -a A=( 1 2 3 4 )
$ array::pick A x
$ echo &quot;${x}&quot;
3</code></pre>
<h1 id="arraypop">array::pop</h1>
<p>array::pop - remove the last element from an array</p>
<h3 id="synopsis-31">SYNOPSIS</h3>
<p>array::pop <em>A</em> [<em>x</em>]</p>
<h3 id="description-31">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>x</em> a variable,
<code>array::pop</code> sets <em>x</em> to the last element from
<em>A</em> before removing it. If <em>x</em> is not specified, it
defaults to the special variable <code>$__</code>.</p>
<p><code>array::pop</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-15">EXAMPLE</h3>
<pre><code>$ declare -a A=( 1 2 3 4 )
$ array::pop A x
$ echo &quot;${A[@]}&quot;
1 2 3
$ echo &quot;${x}&quot;
4</code></pre>
<h3 id="see-also-27">SEE ALSO</h3>
<p><code>array::popi(1)</code></p>
<h1 id="arraypopi">array::popi</h1>
<p>array::popi - remove the ith element from an array</p>
<h3 id="synopsis-32">SYNOPSIS</h3>
<p>array::popi <em>A</em> <em>i</em> [<em>x</em>]</p>
<h3 id="description-32">DESCRIPTION</h3>
<p>With <em>A</em> an array variable <em>i</em> an index and <em>x</em>
a variable, <code>array::popi</code> sets <em>x</em> to the ith element
from <em>A</em> before removing it. If <em>i</em> is negative, the
element is removed starting from the end of <em>A</em>. If <em>x</em> is
not specified, it defaults to the special variable <code>$__</code>.</p>
<p><code>array::popi</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-16">EXAMPLE</h3>
<pre><code>$ declare -a A=( 1 2 3 4 )
$ array::popi A 2 x
$ echo &quot;${A[@]}&quot;
1 2 4
$ echo &quot;${x}&quot;
3</code></pre>
<h3 id="see-also-28">SEE ALSO</h3>
<p><code>array::pop(1)</code>, <code>array::shift(1)</code></p>
<h1 id="arraypush">array::push</h1>
<p>array::push - add one or more elements to the end of an array</p>
<h3 id="synopsis-33">SYNOPSIS</h3>
<p>array::push <em>A</em> [<em>x</em> …]</p>
<h3 id="description-33">DESCRIPTION</h3>
<p>With <em>A</em> an array variable <em>x</em> a value,
<code>array::push</code> adds <em>x</em> at the end of <em>A</em>.</p>
<p><code>array::push</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-17">EXAMPLE</h3>
<pre><code>$ declare -a A=( {1..11} )
$ array::push A 12
$ echo &quot;${A[-1]}&quot;
12</code></pre>
<h1 id="arrayreduce">array::reduce</h1>
<p>array::reduce - perform a summary operation of an array</p>
<h3 id="synopsis-34">SYNOPSIS</h3>
<p>array::reduce <em>A</em> <em>fun</em> <em>acc</em></p>
<h3 id="description-34">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <em>fun</em> a bash function that
aggregates <code>$1</code> and <code>$2</code> and prints the result to
<code>stdout</code> and <em>acc</em> a variable,
<code>array::reduce</code> sumarizes <em>A</em> into <em>acc</em> by
repetitively aplying <code>fun acc x</code> for <em>x</em> in
<em>A</em>.</p>
<p><code>array::reduce</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-18">EXAMPLE</h3>
<pre><code>$ declare -a A=( {1..8} )
$ add() { echo $(( $1 + $2 )); }
$ acc=0
$ array::reduce A add acc
$ echo &quot;${acc}&quot;
36</code></pre>
<h3 id="see-also-29">SEE ALSO</h3>
<p><code>array::map(1)</code></p>
<h1 id="arrayreverse">array::reverse</h1>
<p>array::reverse - reverse an array in place</p>
<h3 id="synopsis-35">SYNOPSIS</h3>
<p>array::reverse <em>A</em></p>
<h3 id="description-35">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <code>array::reverse</code>
reverses <em>A</em> in place.</p>
<p><code>array::reverse</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-19">EXAMPLE</h3>
<pre><code>$ declare -a A=( {1..11} )
$ array::reverse A
$ echo &quot;${A[@]}&quot;
11 10 9 8 7 6 5 4 3 2 1</code></pre>
<h1 id="arrayrotate">array::rotate</h1>
<p>array::rotate - shift elements of an array to the specified
positions</p>
<h3 id="synopsis-36">SYNOPSIS</h3>
<p>array::rotate <em>A</em> <em>i</em></p>
<h3 id="description-36">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>i</em> an integer,
<code>array::rotate</code> shifts elements of <em>A</em> to the
specified positions. If <em>i</em> is positive, cycling is done from
right to left, if <em>i</em> is negative, cycling occurs from left to
right.</p>
<p><code>array::rotate</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="examples-21">EXAMPLES</h3>
<pre><code>$ declare -a A=( {1..8} )
$ array::rotate A -10
$ echo &quot;${A[@]}&quot;
3 4 5 6 7 8 1 2</code></pre>
<h1 id="arrayshift">array::shift</h1>
<p>array::shift - remove the first element of an array</p>
<h3 id="synopsis-37">SYNOPSIS</h3>
<p>array::shift <em>A</em> [<em>x</em>]</p>
<h3 id="description-37">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>x</em> a variable,
<code>array::shift</code> removes the first element of <em>A</em> and
sets <em>x</em> to it. If <em>x</em> is not given, it defaults to
special variable <code>$__</code>.</p>
<p><code>array::shift</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-20">EXAMPLE</h3>
<pre><code>$ declare -a A=( {1..8} )
$ array::shift A x
$ (( x == 1 )) &amp;&amp; echo &quot;${A[@]}&quot;
2 3 4 5 6 7 8</code></pre>
<h3 id="see-also-30">SEE ALSO</h3>
<p><code>array::popi(1)</code></p>
<h1 id="arrayshuffle">array::shuffle</h1>
<p>array::shuffle - randomly reorder elements of an array</p>
<h3 id="synopsis-38">SYNOPSIS</h3>
<p>array::shuffle <em>A</em></p>
<h3 id="description-38">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <code>array::shuffle</code>
performs in place a modern fisher-yates shuffling.</p>
<p><code>array::shuffle</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-21">EXAMPLE</h3>
<pre><code>$ declare -a A=( {1..8} )
$ array::shuffle A
$ echo &quot;${A[@]}&quot;
7 6 2 1 3 4 5 8</code></pre>
<h3 id="see-also-31">SEE ALSO</h3>
<p>https://en.wikipedia.org/wiki/Fisher–Yates_shuffle#Modern_method</p>
<h1 id="arraysort">array::sort</h1>
<p>array::sort - sort elements of an array in place</p>
<h3 id="synopsis-39">SYNOPSIS</h3>
<p>array::sort <em>A</em></p>
<h3 id="description-39">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <code>array::sort</code> in place
sorts the array.</p>
<p><code>array::sort</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="examples-22">EXAMPLES</h3>
<pre><code>$ declare -a A=( 8 7 5 6 3 4 1 2 )
$ array::sort A
$ echo &quot;${A[@]}&quot;
1 2 3 4 5 6 7 8</code></pre>
<h1 id="arraysplit">array::split</h1>
<p>array::split - build an array from a split string</p>
<h3 id="synopsis-40">SYNOPSIS</h3>
<p>array::split <em>A</em> <em>str</em> <em>sep</em></p>
<h3 id="description-40">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <em>str</em> and <em>sep</em> two
strings, <code>array::split</code> divides <em>str</em> into an ordered
list of substrings by searching for <em>sep</em>, puts these substrings
in <em>A</em>.</p>
<p><code>array::split</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-22">EXAMPLE</h3>
<pre><code>$ declare -a A
$ array::split A &#39;apples,oranges,pears,grapes&#39; &#39;,&#39;
$ echo &quot;${A[@]}&quot;
apples oranges pears grapes</code></pre>
<h1 id="arrayuniq">array::uniq</h1>
<p>array::uniq - deduplicate elements of an array</p>
<h3 id="synopsis-41">SYNOPSIS</h3>
<p>array::uniq <em>A</em></p>
<h3 id="description-41">DESCRIPTION</h3>
<p>With <em>A</em> an array variable, <code>array:uniq</code>
deduplicates elements in place.</p>
<p><code>array::uniq</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="examples-23">EXAMPLES</h3>
<pre><code>$ declare -a A=( {1..8} )
$ A+=( &quot;${A[@]}&quot; )  # duplicate array items
$ echo &quot;${A[@]}&quot;
1 2 3 4 5 6 7 8 1 2 3 4 5 6 7 8
$ array::uniq A
$ echo &quot;${A[@]}&quot;
1 2 3 4 5 6 7 8</code></pre>
<h1 id="arrayunshift">array::unshift</h1>
<p>array::unshift - add one or more elements to the beginning of an
array</p>
<h3 id="synopsis-42">SYNOPSIS</h3>
<p>array::unshift <em>A</em> [<em>x</em> …]</p>
<h3 id="description-42">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and a list of values <em>x</em>,
<code>array::unshift</code> adds them to the beginning of <em>A</em></p>
<p><code>array::unshift</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-23">EXAMPLE</h3>
<pre><code>$ declare -a A=( {4..8} )
$ array::unshift A 1 2 3
$ echo &quot;${A[@]}&quot;
1 2 3 4 5 6 7 8</code></pre>
<h1 id="arrayzip">array::zip</h1>
<p>array::zip - merge two arrays in a dictionary</p>
<h3 id="synopsis-43">SYNOPSIS</h3>
<p>array::zip <em>D</em> <em>K</em> <em>V</em></p>
<h3 id="description-43">DESCRIPTION</h3>
<p>With <em>D</em> an dictionary (ie. associative array), <em>K</em> and
<em>V</em> two arrays, <code>array::zip</code> merges the arrays into a
dict where keys are taken from <em>K</em> ans associated to values taken
in turn from <em>V</em>.</p>
<p><code>array::zip</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-24">EXAMPLE</h3>
<pre><code>$ declare -A D
$ declare -a K=( {a..e} )
$ declare -a V=( {1..8} )
$ array::zip D K V
$ declare -p D
D=([e]=&quot;5&quot; [d]=&quot;4&quot; [c]=&quot;3&quot; [b]=&quot;2&quot; [a]=&quot;1&quot; )</code></pre>
<h1 id="checkcmd">check::cmd</h1>
<p>check::cmd - check if a command is available</p>
<h3 id="synopsis-44">SYNOPSIS</h3>
<p>check::cmd [<em>cmd</em> …]</p>
<h3 id="description-44">DESCRIPTION</h3>
<p>With a list of <em>cmd</em>, <code>check::cmd</code> verify that
<em>cmd</em> is executable.</p>
<p><code>check::cmd</code> returns 0 if <em>cmd</em> is executable,
&gt;0 otherwise.</p>
<h3 id="example-25">EXAMPLE</h3>
<pre><code>$ check::cmd ls cat &amp;&amp; echo &quot;ls and cat are available&quot;
ls and cat are available</code></pre>
<h1 id="checkdir">check::dir</h1>
<p>check::dir - ensure a directory exists</p>
<h3 id="synopsis-45">SYNOPSIS</h3>
<p>check::dir [<em>dir</em> …]</p>
<h3 id="description-45">DESCRIPTION</h3>
<p>With <em>dir</em> a directory, <code>check::dir</code> ensures that
it exists, if not it creates it.</p>
<p><code>check::dir</code> returns 0 if <em>dir</em> exists or has been
created, &gt;0 otherwise.</p>
<h3 id="example-26">EXAMPLE</h3>
<pre><code>$ check::dir /usr /tmp/mydir</code></pre>
<h1 id="checkvartype">check::vartype</h1>
<p>check::vartype - check variable attributes</p>
<h3 id="synopsis-46">SYNOPSIS</h3>
<p>check::vartype <em>attrs</em> <em>var</em></p>
<h3 id="description-46">DESCRIPTION</h3>
<p>With <em>attrs</em> an attribute string and <em>var</em> a variable,
<code>check::vartype</code> checks if <em>var</em> has set
<em>attrs</em>. It does NOT check the content of <em>var</em>.</p>
<p>Some <em>attrs</em> are inherited from builtin
<code>declare</code>:</p>
<table>
<thead>
<tr class="header">
<th>attr</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>a</em></td>
<td>indexed array</td>
</tr>
<tr class="even">
<td><em>A</em></td>
<td>dictionary</td>
</tr>
<tr class="odd">
<td><em>i</em></td>
<td>integer</td>
</tr>
<tr class="even">
<td><em>l</em></td>
<td>lower case</td>
</tr>
<tr class="odd">
<td><em>n</em></td>
<td>nameref</td>
</tr>
<tr class="even">
<td><em>r</em></td>
<td>readonly</td>
</tr>
<tr class="odd">
<td><em>t</em></td>
<td>trace</td>
</tr>
<tr class="even">
<td><em>u</em></td>
<td>upper case</td>
</tr>
<tr class="odd">
<td><em>x</em></td>
<td>export</td>
</tr>
</tbody>
</table>
<p>to which bashkit adds:</p>
<table>
<thead>
<tr class="header">
<th>attr</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><em>f</em></td>
<td>function</td>
</tr>
<tr class="even">
<td><em>s</em></td>
<td>set</td>
</tr>
</tbody>
</table>
<p>A <em>var</em> can be set to an empty value. When checking for a
nameref and more, <em>var</em> is dereferenced before checking for more
<em>attrs</em> than <em>n</em>.</p>
<p><code>check::vartype</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="examples-24">EXAMPLES</h3>
<pre><code>$ declare -a ARR=()
$ declare -n _A=ARR
$ check::vartype nas _A &amp;&amp; echo OK
OK
$ n=0  # no integer attribute
$ check::vartype i n || echo NOK
NOK</code></pre>
<h3 id="see-also-32">SEE ALSO</h3>
<p>builtin <code>declare</code></p>
<h1 id="curldownload">curl::download</h1>
<p>curl::download - download a file from an URL and print stats</p>
<h3 id="synopsis-47">SYNOPSIS</h3>
<p>curl::download <em>url</em> <em>dest</em></p>
<h3 id="description-47">DESCRIPTION</h3>
<p>With <em>dest</em> being a filename, <code>curl::download</code>
prints a downloading digest that contains the size and md5 hash of the
downloaded file.</p>
<p>In baskhit, <code>curl</code> hence <code>curl::download</code> are
preset with: | option | value | |—————–|——-| | connect-timeout | 5 | |
continue-at | - | | fail | | | location | | | retry | 5 | | retry-delay
| 0 | | retry-max-time | 40 | | show-error | | | silent | |</p>
<p><code>curl::download</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-27">EXAMPLE</h3>
<pre><code>$ curl::download http://example.com &quot;${tmpfile}&quot;</code></pre>
<h3 id="see-also-33">SEE ALSO</h3>
<p><code>curl(1)</code></p>
<h1 id="funlist">funlist</h1>
<p>funlist - list all declared functions</p>
<h3 id="synopsis-48">SYNOPSIS</h3>
<p>funlist</p>
<h3 id="description-48">DESCRIPTION</h3>
<p><code>funlist</code> is part of bashkit module extras, it lists all
declared functions by the time of calling.</p>
<h3 id="example-28">EXAMPLE</h3>
<pre><code>  $ funlist
  __unhandled
  alert
  bashkit::help
  bashkit::init
  bashkit::load
  bashkit::main
  ...</code></pre>
<h1 id="isint">isint</h1>
<p>isint - test for integers</p>
<h3 id="synopsis-49">SYNOPSIS</h3>
<p>isint [<em>x</em> …]</p>
<h3 id="description-49">DESCRIPTION</h3>
<p><code>isint</code> is part of bashkit module <code>extras</code>,
given <em>x</em> a value, it tests if <em>x</em> is an integer.</p>
<p><code>isint</code> returns 0 if all <em>x</em> are integers, &gt;0
otherwise.</p>
<h3 id="example-29">EXAMPLE</h3>
<pre><code>  $ n=10
  $ isint &quot;${n}&quot; 1 2 3 4 || echo yes
  $ yes</code></pre>
<h1 id="join">join</h1>
<p>join - build a string of arguments separated by a given character</p>
<h3 id="synopsis-50">SYNOPSIS</h3>
<p>join <em>sep</em> <em>arg</em> [<em>arg</em> …]</p>
<h3 id="description-50">DESCRIPTION</h3>
<p><code>join</code> is part of bashkit module <code>extras</code>,
given <em>sep</em> a single character and <em>arg</em> a list of
arbitrary strings, it builds a string with all <em>args</em> separated
by <em>sep</em>.</p>
<h3 id="examples-25">EXAMPLES</h3>
<pre><code>  $ join &quot;,&quot; a b c d
  a,b,c,d
  $ join &quot;:&quot; a
  a</code></pre>
<h1 id="now">now</h1>
<p>now - get the number of milliseconds elapsed since EPOCH</p>
<h3 id="synopsis-51">SYNOPSIS</h3>
<p>now [<em>dest</em>]</p>
<h3 id="description-51">DESCRIPTION</h3>
<p><code>now</code> is part of bashkit module <code>extras</code>, it
sets <em>dest</em> var to the number of milliseconds elapsed since
EPOCH. If <em>dest</em> is omitted, <code>now</code> sets the special
variable <code>$__</code>.</p>
<h3 id="example-30">EXAMPLE</h3>
<pre><code>  $ now start
  $ sleep 1
  $ now end
  $ echo $(( end - start ))
  1008</code></pre>
<h1 id="progress">progress</h1>
<p>progress - display a progress bar</p>
<h3 id="synopsis-52">SYNOPSIS</h3>
<p>progress <em>percent</em> <em>total</em></p>
<h3 id="description-52">DESCRIPTION</h3>
<p><code>progress</code> is part of bashkit module <code>extras</code>,
given two integers <em>percent</em> and <em>total</em>, it displays a
progress bar. This bar has a len of <em>total</em> dashes.</p>
<h3 id="example-31">EXAMPLE</h3>
<pre><code>  $ for (( i=0; i&lt;=100; i++ )); do
  &gt;   usleep 5
  &gt;   progress &quot;${i}&quot; 20
  &gt; done
  &gt; printf &#39;\n&#39;
  [--------------------]</code></pre>
<h1 id="urldecode">urldecode</h1>
<p>urldecode - percent decode a string</p>
<h3 id="synopsis-53">SYNOPSIS</h3>
<p>urldecode <em>url</em></p>
<h3 id="description-53">DESCRIPTION</h3>
<p><code>urldecode</code> is part of bashkit module <code>extras</code>,
given a percent-encoded <em>url</em>, it restores it to its original
form.</p>
<p><code>urldecode</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-32">EXAMPLE</h3>
<pre><code>$ urldecode &quot;https%3A%2F%2Fgithub.com%2Fdylanaraps%2Fpure-bash-bible&quot;
https://github.com/dylanaraps/pure-bash-bible</code></pre>
<h3 id="see-also-34">SEE ALSO</h3>
<p><code>urlencode(1)</code></p>
<h1 id="urlencode">urlencode</h1>
<p>urlencode - percent encode a string</p>
<h3 id="synopsis-54">SYNOPSIS</h3>
<p>urlencode <em>url</em></p>
<h3 id="description-54">DESCRIPTION</h3>
<p><code>urlencode</code> is part of bashkit module <code>extras</code>,
given an <em>url</em> string, it displays a percent encoded version of
it.</p>
<p><code>urlencode</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-33">EXAMPLE</h3>
<pre><code>$ urlencode &quot;https://github.com/dylanaraps/pure-bash-bible&quot;
https%3A%2F%2Fgithub.com%2Fdylanaraps%2Fpure-bash-bible</code></pre>
<h3 id="see-also-35">SEE ALSO</h3>
<p><code>urldecode(1)</code></p>
<h1 id="usleep">usleep</h1>
<p>usleep - micro sleep</p>
<h3 id="synopsis-55">SYNOPSIS</h3>
<p>usleep [<em>n</em>]</p>
<h3 id="description-55">DESCRIPTION</h3>
<p><code>usleep</code> is part of bashkit module <code>extras</code>, it
waits for a delay proportional to <em>n</em>. When <em>n</em> is
omitted, it defaults to 1.</p>
<h3 id="example-34">EXAMPLE</h3>
<pre><code>$ usleep 10</code></pre>
<h1 id="interactiveyesno">interactive::yesno</h1>
<p>interactive::yesno - ask a yes/no question to the user</p>
<h3 id="synopsis-56">SYNOPSIS</h3>
<p>interactive::yesno <em>question</em> [<em>default</em>]</p>
<h3 id="description-56">DESCRIPTION</h3>
<p><code>interactive::yesno</code> displays <em>question</em> and wait
for the user to answer, if <em>default</em> is given, it is used if the
user simply presses <code>ENTER</code>.</p>
<p><code>interactive::yesno</code> returns 0 when user answers
<code>yes</code>, &gt;0 otherwise</p>
<h3 id="example-35">EXAMPLE</h3>
<pre><code>$ interactive::yesno &quot;are you happy?&quot; y
are you happy? [YES/no]:</code></pre>
<h1 id="jsonfrom_toml">json::from_toml</h1>
<p>json::from_toml - convert toml to json</p>
<h3 id="synopsis-57">SYNOPSIS</h3>
<p>json::from_toml <em>toml</em></p>
<h3 id="description-57">DESCRIPTION</h3>
<p>Given a <em>toml</em> string, <code>json::from_toml</code> converts
it to JSON.</p>
<p><code>json::from_toml</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="see-also-36">SEE ALSO</h3>
<p><code>json::to_toml(1)</code></p>
<h1 id="jsonfrom_yaml">json::from_yaml</h1>
<p>json::from_yaml - convert yaml to json</p>
<h3 id="synopsis-58">SYNOPSIS</h3>
<p>json::from_yaml <em>yaml</em></p>
<h3 id="description-58">DESCRIPTION</h3>
<p>Given a <em>yaml</em> string, <code>json::from_yaml</code> converts
it to json.</p>
<p><code>json::from_yaml</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="see-also-37">SEE ALSO</h3>
<p><code>json::to_yaml(1)</code></p>
<h1 id="jsoninto_array">json::into_array</h1>
<p>json::into_array - load a json array into a bash array</p>
<h3 id="synopsis-59">SYNOPSIS</h3>
<p>json::into_array <em>A</em> <em>jarr</em></p>
<h3 id="description-59">DESCRIPTION</h3>
<p>With <em>A</em> an array variable and <em>jarr</em> a string
representing a json array, <code>json::into_array</code> loads
<em>jarr</em> content into <em>A</em>.</p>
<p><code>json::into_array</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-36">EXAMPLE</h3>
<pre><code>$ json=&#39;[&quot;a&quot;, &quot;b&quot;, 3, 7]&#39;
$ declare -a A
$ json::into_array A &lt;&lt;&lt; &quot;${json}&quot;
$ echo &quot;${A[@]}&quot;
a b 3 7</code></pre>
<h3 id="see-also-38">SEE ALSO</h3>
<p><code>json::into_dict(1)</code></p>
<h1 id="jsoninto_dict">json::into_dict</h1>
<p>json::into_dict - load a json dictionary into a bash one</p>
<h3 id="synopsis-60">SYNOPSIS</h3>
<p>json::into_dict <em>D</em> <em>jdict</em></p>
<h3 id="description-60">DESCRIPTION</h3>
<p>With <em>D</em> an associative array variable and <em>jdict</em> a
json dictionary, <code>json::into_dict</code> loads <em>jdict</em>
content into <em>D</em>. It does NOT recurse because bash does not
support nested dictionaries.</p>
<p><code>json::into_dict</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-37">EXAMPLE</h3>
<pre><code>$ json=&#39;{&quot;a&quot;: 3, &quot;7&quot;: { &quot;sub&quot;: [3, true, &quot;x&quot;] }}&#39;
$ declare -A D
$ json::into_dict D &lt;&lt;&lt; &quot;${json}&quot;
$ echo &quot;${!D[@]}
a 7
$ echo &quot;${D[7]}&quot;
{ &quot;sub&quot;: [3, true, &quot;x&quot;] }</code></pre>
<h3 id="see-also-39">SEE ALSO</h3>
<p><code>json::into_array(1)</code></p>
<h1 id="jsonto_toml">json::to_toml</h1>
<p>json::to_toml - convert json to toml</p>
<h3 id="synopsis-61">SYNOPSIS</h3>
<p>json::to_toml <em>fd</em></p>
<h3 id="description-61">DESCRIPTION</h3>
<p>With <em>fd</em> a file descriptor, <code>json::to_toml</code> reads
json from <em>fd</em> and prints the resulting toml to
<code>stdout</code>.</p>
<p><code>json::to_toml</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-38">EXAMPLE</h3>
<pre><code>$ printf &#39;%s\n&#39; &quot;${json}&quot; | json::to_toml /dev/stdin</code></pre>
<h3 id="see-also-40">SEE ALSO</h3>
<p><code>json::from_toml(1)</code></p>
<h1 id="jsonto_yaml">json::to_yaml</h1>
<p>json::to_yaml - convert json to toml</p>
<h3 id="synopsis-62">SYNOPSIS</h3>
<p>json::to_yaml <em>fd</em></p>
<h3 id="description-62">DESCRIPTION</h3>
<p>With <em>fd</em> a file descriptor, <code>json::to_yaml</code> reads
json from <em>fd</em> and prints the resulting yaml to
<code>stdout</code>.</p>
<p><code>json::to_yaml</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-39">EXAMPLE</h3>
<pre><code>$ printf &#39;%s\n&#39; &quot;${json}&quot; | json::to_yaml /dev/stdin</code></pre>
<h3 id="see-also-41">SEE ALSO</h3>
<p><code>json::from_yaml(1)</code></p>
<h1 id="patchapply">patch::apply</h1>
<p>patch::apply - apply a patch</p>
<h3 id="synopsis-63">SYNOPSIS</h3>
<p>patch::apply <em>dir</em> <em>patch</em></p>
<h3 id="description-63">DESCRIPTION</h3>
<p>Witn <em>dir</em> a destination directory and <em>patch</em> a patch
file, <code>patch::apply</code> applies modification from <em>patch</em>
to <em>dir</em> files.</p>
<p><code>patch::apply</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-40">EXAMPLE</h3>
<pre><code>$ patch::apply &quot;${DIR}&quot; &quot;a.patch&quot;</code></pre>
<h3 id="see-also-42">SEE ALSO</h3>
<p><code>diff(1)</code>, <code>patch(1)</code>,
<code>patch::batch(1)</code></p>
<h1 id="patchbatch">patch::batch</h1>
<p>patch::batch - apply all patches from a patch directory onto files in
a target directory</p>
<h3 id="synopsis-64">SYNOPSIS</h3>
<p>patch::batch <em>target</em> <em>patches</em></p>
<h3 id="description-64">DESCRIPTION</h3>
<p>Witn <em>target</em> a destination directory and <em>patches</em> a
patch directory, <code>patch::batch</code> applies modification from
<em>patches</em> to <em>target</em> files.</p>
<p><code>patch::batch</code> returns 0 upon success, &gt;0
otherwise.</p>
<h3 id="example-41">EXAMPLE</h3>
<pre><code>$ patch::batch &quot;${TARGET_DIR}&quot; &quot;${PATCH_DIR}&quot;</code></pre>
<h3 id="see-also-43">SEE ALSO</h3>
<p><code>diff(1)</code>, <code>patch(1)</code>,
<code>patch::apply(1)</code></p>
<h1 id="permsgid">perms::gid</h1>
<p>perms::gid - convert group name to gid</p>
<h3 id="synopsis-65">SYNOPSIS</h3>
<p>perms::gid <em>group</em></p>
<h3 id="description-65">DESCRIPTION</h3>
<p>With <em>group</em> a group name as given by <code>id -g</code>,
<code>perms::gid</code> converts it to a gid integer as given by
<code>id -gn</code>.</p>
<p><code>perms::gid</code> returns 0 upon success, &gt;0 and logs an
error otherwise.</p>
<h3 id="example-42">EXAMPLE</h3>
<pre><code>$ perms::gid wheel
0</code></pre>
<h3 id="see-also-44">SEE ALSO</h3>
<p><code>id(1)</code>, <code>perms::uid(1)</code></p>
<h1 id="permsmode">perms::mode</h1>
<p>perms::mode - convert symbolic file mode to absolute notation</p>
<h3 id="synopsis-66">SYNOPSIS</h3>
<p>perms::mode <em>mode</em></p>
<h3 id="description-66">DESCRIPTION</h3>
<p>With <em>mode</em> an absolute mode as defined in
<code>chmod(1)</code>, <code>perms::mode</code> convert it to its
absolute representation.</p>
<p><code>perms::mode</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="example-43">EXAMPLE</h3>
<pre><code>$ perms::mode &quot;-rw-r--r--&quot;
0644</code></pre>
<h3 id="see-also-45">SEE ALSO</h3>
<p><code>chmod(1)</code></p>
<h1 id="permsuid">perms::uid</h1>
<p>perms::uid - convert user name to uid</p>
<h3 id="synopsis-67">SYNOPSIS</h3>
<p>perms::uid <em>user</em></p>
<h3 id="description-67">DESCRIPTION</h3>
<p>With <em>user</em> a user name as given by <code>id -u</code>,
<code>perms::uid</code> converts it to an uid integer as given by
<code>id -un</code>.</p>
<p><code>perms::uid</code> returns 0 upon success, &gt;0 and logs an
error otherwise.</p>
<h3 id="example-44">EXAMPLE</h3>
<pre><code>$ perms::uid root
0</code></pre>
<h3 id="see-also-46">SEE ALSO</h3>
<p><code>id(1)</code>, <code>perms::gid(1)</code></p>
<h1 id="readlinkf">readlinkf</h1>
<p>readlinkf - display symbolic link target status</p>
<h3 id="synopsis-68">SYNOPSIS</h3>
<p>readlinkf <em>filelink</em></p>
<h3 id="description-68">DESCRIPTION</h3>
<p>With <em>filelink</em> a symbolic link, <code>readlinkf</code>
resolves paths and displays the corresponding absolute pathname.</p>
<p><code>readlinkf</code> returns 0 upon success, &gt;0 otherwise.</p>
<h3 id="see-also-47">SEE ALSO</h3>
<p><code>readlink(1)</code>, https://github.com/ko1nksm/readlinkf</p>
<h1 id="shoptpop">shopt::pop</h1>
<p>shopt::pop - restores previous shopt context</p>
<h3 id="synopsis-69">SYNOPSIS</h3>
<p>shopt::pop</p>
<h3 id="description-69">DESCRIPTION</h3>
<p><code>shopt::pop</code> restores a builtin <code>shopt</code> context
previously created by calling <code>shopt::push(1)</code>.</p>
<p><code>shopt::pop</code> always succeeds and returns 0.</p>
<h3 id="example-45">EXAMPLE</h3>
<pre><code>$ shopt::push
$ shopt -s extdebug
$ do_something_with_extdebug_on
$ shopt::pop</code></pre>
<h3 id="see-also-48">SEE ALSO</h3>
<p>builtin <code>shopt</code>, <code>shopt::push(1)</code></p>
<h1 id="shoptpush">shopt::push</h1>
<p>shopt::push - create a new shopt context</p>
<h3 id="synopsis-70">SYNOPSIS</h3>
<p>shopt::push</p>
<h3 id="description-70">DESCRIPTION</h3>
<p><code>shopt::push</code> creates a new <code>shopt</code> context
that can be modified and discarded later by a call to
<code>shopt::pop(1)</code>.</p>
<p><code>shopt::push</code> always succeeds and returns 0.</p>
<h3 id="example-46">EXAMPLE</h3>
<pre><code>$ shopt::push
$ shopt -s extdebug
$ do_something_with_extdebug_on
$ shopt::pop</code></pre>
<h3 id="see-also-49">SEE ALSO</h3>
<p>builtin <code>shopt</code>, <code>shopt::push(1)</code></p>
<h1 id="stringlstrip">string::lstrip</h1>
<p>string::lstrip - remove pattern from start of string</p>
<h3 id="synopsis-71">SYNOPSIS</h3>
<p>string::lstrip <em>str</em> <em>pat</em></p>
<h3 id="description-71">DESCRIPTION</h3>
<p>With <em>str</em> and <em>pat</em> two strings,
<code>string::lstrip</code> removes <em>pat</em> occuring at
<em>str</em> start (or left side).</p>
<h3 id="examples-26">EXAMPLES</h3>
<pre><code>$ string::lstrip &#39;The Quick Brown Fox&#39; &#39;The &#39;
Quick Brown Fox</code></pre>
<h3 id="see-also-50">SEE ALSO</h3>
<p><code>string::rstrip(1)</code>, <code>string::strip(1)</code>,
<code>string::stripall(1)</code></p>
<h1 id="stringregex">string::regex</h1>
<p>string::regex - match string against regular expression</p>
<h3 id="synopsis-72">SYNOPSIS</h3>
<p>string::regex <em>str</em> <em>rex</em></p>
<h3 id="description-72">DESCRIPTION</h3>
<p>With <em>str</em> and <em>rex</em> two strings,
<code>string::regex</code> matches <em>str</em> again regular expression
<em>rex</em> and displays the matching part of <em>str</em>.</p>
<p><code>string::regex</code> returns 0 upon match, &gt;0 otherwise.</p>
<h3 id="example-47">EXAMPLE</h3>
<pre><code>$ string::regex &#39;    hello&#39; &#39;^[[:space:]]*(.*)&#39;
hello</code></pre>
<h1 id="stringrstrip">string::rstrip</h1>
<p>string::rstrip - remove pattern from end of string</p>
<h3 id="synopsis-73">SYNOPSIS</h3>
<p>string::rstrip <em>str</em> <em>pat</em></p>
<h3 id="description-73">DESCRIPTION</h3>
<p>With <em>str</em> and <em>pat</em> two strings,
<code>string::rstrip</code> removes <em>pat</em> occuring at
<em>str</em> end (or right side).</p>
<h3 id="example-48">EXAMPLE</h3>
<pre><code>$ string::rstrip &#39;The Quick Brown Fox&#39; &#39; Fox&#39;
The Quick Brown</code></pre>
<h3 id="see-also-51">SEE ALSO</h3>
<p><code>string::lstrip(1)</code>, <code>string::strip(1)</code>,
<code>string::stripall(1)</code></p>
<h1 id="stringsplit">string::split</h1>
<p>string::split - extract substrings delimited by a separator from
string</p>
<h3 id="synopsis-74">SYNOPSIS</h3>
<p>string::split <em>str</em> <em>sep</em></p>
<h3 id="description-74">DESCRIPTION</h3>
<p>With <em>str</em> and <em>sep</em>, two strings,
<code>string::split</code> splits <em>str</em> on <em>sep</em>
occurences.</p>
<h3 id="example-49">EXAMPLE</h3>
<pre><code>$ string::split &#39;apples,oranges,pears,grapes&#39; &#39;,&#39;
apples oranges pears grapes</code></pre>
<h1 id="stringstrip">string::strip</h1>
<p>string::strip - remove first occuring pattern from string</p>
<h3 id="synopsis-75">SYNOPSIS</h3>
<p>string::strip <em>str</em> <em>pat</em></p>
<h3 id="description-75">DESCRIPTION</h3>
<p>With <em>str</em> and <em>pat</em> two strings,
<code>string::strip</code> removes the first occurence of <em>pat</em>
in <em>str</em>.</p>
<h3 id="example-50">EXAMPLE</h3>
<pre><code>$ string::strip &#39;The Quick Brown Fox&#39; &#39;[aeiou]&#39;
Th Quick Brown Fox</code></pre>
<h3 id="see-also-52">SEE ALSO</h3>
<p><code>string::stripall(1)</code>, <code>string::lstrip(1)</code>,
<code>string::rstrip(1)</code></p>
<h1 id="stringstripall">string::stripall</h1>
<p>string::stripall - remove pattern from string</p>
<h3 id="synopsis-76">SYNOPSIS</h3>
<p>string::stripall <em>str</em> <em>pat</em></p>
<h3 id="description-76">DESCRIPTION</h3>
<p>With <em>str</em> and <em>pat</em> two strings,
<code>string::stripall</code> removes all occurences of <em>pat</em> in
<em>str</em>.</p>
<h3 id="example-51">EXAMPLE</h3>
<pre><code>$ string::strip &#39;The Quick Brown Fox&#39; &#39;[aeiou]&#39;
Th Quck Brwn Fx</code></pre>
<h3 id="see-also-53">SEE ALSO</h3>
<p><code>string::strip(1)</code>, <code>string::lstrip(1)</code>,
<code>string::rstrip(1)</code></p>
<h1 id="stringtrim">string::trim</h1>
<p>string::trim - remove leadind and trailing spaces from string</p>
<h3 id="synopsis-77">SYNOPSIS</h3>
<p>string::trim <em>str</em></p>
<h3 id="description-77">DESCRIPTION</h3>
<p><code>string::trim</code> removes all leading and trailing spaces
from string <em>str</em>.</p>
<h3 id="example-52">EXAMPLE</h3>
<p>$ string::trim ’ Hello, world ’ Hello, world</p>
</body>
</html>
